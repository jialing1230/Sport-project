<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <link rel="manifest" href="/static/manifest.json" />
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/static/service-worker.js")
          .then(() => console.log("Service Worker Registered"))
          .catch((error) =>
            console.error("Service Worker Registration Failed:", error)
          );
      }
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç™¼èµ·èª²ç¨‹</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      .container {
        max-width: 800px;
        width: 100%;
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .title-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
      }
      .title-left,
      .title-right {
        width: 60px; /* å’Œ SVG å¯¬åº¦å·®ä¸å¤šï¼Œä¿æŒå°ç¨± */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .title-center {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        flex-grow: 1;
      }
      .back-button {
        background: none;
        border: none;
        cursor: pointer;
      }
      .logo-inline {
        width: 50px;
        height: 50px;
        object-fit: contain;
        border-radius: 50%;
      }
      h1 {
        color: #2c4975;
        white-space: nowrap;
        font-size: 24px;
        margin: 0;
      }
      .form-row {
        margin-bottom: 20px;
      }
      .form-label {
        margin-bottom: 20px;
        font-weight: bold;
        color: #2c4975;
        display: block;
      }
      .radio-card-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
      }
      .radio-card {
        padding: 10px 20px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
		font-size: 15px;
	    user-select: none;
	    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .radio-card input {
        display: none;
      }
	  .radio-card:hover {
	   background-color: #eaf3fa;
	   color: #2c4975;
	  }
      .radio-card:has(input:checked) {
        background-color: #81d3e1;
        color: white;
		font-weight: bold;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
	  .radio-card:active {
	   transform: scale(0.96);
	  }
	  .radio-card:has(input:checked) span {
		  color: white; /* å°ˆé–€è®“åŒ…ä½æ–‡å­—çš„ span è®Šç™½è‰² */
		}
      .btn-primary {
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        color: white;
        background-color: #81d3e1;
        width: 100%;
        transition: 0.2s ease;
      }
      .btn-primary:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      .btn-primary:hover:enabled {
        background-color: #2c4975;
      }
      input[type="text"],
      input[type="datetime-local"],
      input[type="number"],
      textarea {
        padding: 10px;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }
      textarea {
        resize: vertical;
        min-height: 100px;
      }
      #other-sport-row {
        margin-top: 16px;
        display: none;
      }
      .back-button {
        background: none;
        border: none;
        cursor: pointer;
        margin-left: -8px; /* â† æ§åˆ¶å¾€å·¦ */
      }
      .arrow-icon {
        fill: #2c4975;
        transition: fill 0.2s ease;
      }

      .back-button:hover .arrow-icon {
        fill: #81d3e1;
      }
	  
	  .course-type {
	   display: flex;
	   gap: 18px; /* æ§åˆ¶æŒ‰éˆ•ä¹‹é–“çš„é–“è· */
	   flex-wrap: wrap; /* å¦‚æœè¢å¹•å¤ªå°æœƒè‡ªå‹•æ›è¡Œ */
	   margin-top: 8px;
	  }

      .course-type button.active {
        background-color: #81d3e1;
        color: white;
        font-weight: bold;
        }
      .course-type button {
        padding: 10px 15px;
        border: 1px solid #ccc;
        background-color: white;
        color: #2c4975;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        font-size: 16px;
        justify-content: center;
        }

       .weekday-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 8px;
        }

       .weekday-btn {
        padding: 10px 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: white;
        color: #2c4975;
        cursor: pointer;
        transition: all 0.2s ease;
        user-select: none;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

       .weekday-btn input {
        display: none;
        }

       .weekday-btn:has(input:checked) {
        background-color: #81d3e1;
        color: white;
        border-color: #ccc;
        font-weight: bold;
        }

        .form-label-with-action {
        display: flex;
        justify-content: space-between;
        align-items: center;
        }

        .text-button {
        background: none;
        border: none;
        color: #81d3e1;
        font-size: 14px;
        cursor: pointer;
        font-weight: bold;
        }

        .text-button:hover {
        color: #81d3e1;
        }

        .dropdown-list {
        margin-top: 8px;
        padding: 8px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 4px;
        list-style-type: none;
        max-height: 200px;
        overflow-y: auto;
        }

        .dropdown-list li {
        padding: 6px 10px;
        cursor: pointer;
        }

        .dropdown-list li:hover {
        background-color: #eaf3fa;
        }
		.half-row {
		  display: flex;
		  gap: 16px;
		  align-items: center;
		}

		.half-input,
		.half-button {
		  flex: 1;
		}

		.half-button {
		  padding: 10px;
		  font-size: 14px;
		}
		.btn-generate {
		  padding: 10px 15px;
		  font-size: 16px;
		  background-color: #81d3e1;   /* è—ç¶ è‰²èƒŒæ™¯ */
		  color: white;                /* ç™½å­— */
		  border: 1px solid #ccc;   /* æ·±ä¸€é»çš„è—ç¶ é‚Šæ¡† */
		  border-radius: 6px;
		  cursor: pointer;
		  transition: all 0.2s ease;
		  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
		  font-weight: bold;
		  white-space: nowrap;
		  max-width: 160px; /* âœ… é™åˆ¶æœ€å¤§å¯¬åº¦ */
		  flex-shrink: 0;   /* âœ… ä¸æœƒè¢«å£“æ‰ */
		}

		.btn-generate:hover {
		  background-color: #2c4975;   /* æ·±è— hover è‰² */
		  border-color: #2c4975;
		}

		.btn-generate:active {
		  transform: scale(0.96);
		}


    </style>
  </head>
  <body>
    <div class="container">
      <div class="title-row">
        <div class="title-left">
          <button onclick="history.back()" class="back-button">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              class="arrow-icon"
              viewBox="0 0 256 256"
            >
              <path
                d="M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"
              />
            </svg>
          </button>
        </div>
        <div class="title-center">
          <img src="/static/logo.png" alt="Logo" class="logo-inline" />
          <h1>ç™¼èµ·èª²ç¨‹</h1>
        </div>
        <div class="title-right"><!-- é ç•™ç©ºé–“ç”¨ --></div>
      </div>
      <form id="classForm">
  <!-- è¡¨å–®æ¬„ä½å€‘ -->
    <div class="form-row">
        <div class="form-label-with-action">
            <label class="form-label">èª²ç¨‹åç¨±</label>
            <button type="button" class="text-button" onclick="togglePastTitles()">æ›¾ç™¼èµ·çš„æ´»å‹•</button>
        </div>
        <input type="text" name="title" placeholder="å…¬é–‹é¡¯ç¤ºï¼Œè«‹ç°¡æ˜æ¸…æ¥š" required />
        <ul id="pastTitles" class="dropdown-list" style="display: none;"></ul>
    </div>

  <div class="form-row">
    <label class="form-label">é¡å‹</label>
    <div class="radio-card-group" id="sport-options"></div>
    <div class="form-row" id="other-sport-row">
      <input type="text" id="other-sport-input" placeholder="è«‹è¼¸å…¥å…¶ä»–é¡å‹" />
    </div>
  </div>

  <div class="form-row">
    <label class="form-label">åœ°é»</label>
    <div style="display: flex; gap: 10px;">
      <input
        type="text"
        id="place-input"
        name="location"
        placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€"
        required
        style="flex: 1;"
      />
    </div>
    <input type="hidden" id="location-lat" name="location_lat" />
    <input type="hidden" id="location-lng" name="location_lng" />
  </div>
  
  <div class="form-row">
    <label class="form-label">åœ°åœ–é è¦½</label>
    <div
      id="map"
      style="width: 100%; height: 300px; border: 1px solid #ccc; border-radius: 4px;"
    ></div>
  </div>

  <div class="form-row">
    <label class="form-label">èª²ç¨‹æ™‚é–“</label>
    <div class="course-type">
      <button type="button" onclick="selectCourseType('single')" id="btn-single" class="active">å–®ã€€å ‚ã€€èª²ã€€ç¨‹</button>
      <button type="button" onclick="selectCourseType('multi')" id="btn-multi">å¤šã€€å ‚ã€€èª²ã€€ç¨‹</button>
    </div>
  </div>

  <!-- âœ… å–®å ‚èª²ç¨‹è¡¨å–® -->
  <div id="single-course-form">
    <div class="form-row">
      <label class="form-label">èª²ç¨‹é–‹å§‹æ™‚é–“</label>
      <input type="datetime-local" name="startTime" required />
    </div>
    <div class="form-row">
      <label class="form-label">èª²ç¨‹çµæŸæ™‚é–“</label>
      <input type="datetime-local" name="endTime" required />
    </div>
    <div class="form-row">
          <label class="form-label">äººæ•¸</label>
          <input
            type="number"
            name="numPeople"
            placeholder="è«‹è¼¸å…¥æ­£ç¢ºäººæ•¸"
            required
            min="1"
          />
        </div>
    <div class="form-row">
      <label class="form-label">è²»ç”¨NTDï¼ˆæ¯ä½å­¸å“¡ï¼‰</label>
      <input type="number" name="venue_fee" placeholder="è«‹è¼¸å…¥æ¯ä½å­¸å“¡è²»ç”¨" step="0.01" min="0" required />
    </div>
    <div class="form-row">
      <label class="form-label">å ±åæˆªæ­¢æ—¥æœŸ</label>
      <input type="datetime-local" name="registration_deadline" required />
    </div>
	<div class="form-row">
          <label class="form-label">æ€§åˆ¥</label>
          <div class="radio-card-group">
            <label class="radio-card">
			  <input type="radio" name="gender" value="ç”·æ€§" required />
			  <span>ç”·æ€§</span>
			</label>
            <label class="radio-card"
              ><input
                type="radio" name="gender" value="å¥³æ€§" required />
			  <span>å¥³æ€§</span>
			</label>
           <label class="radio-card">
			  <input type="radio" name="gender" value="ä¸é™" required />
			  <span>ä¸é™</span>
			</label>
		  </div>
		</div>

		<div class="form-row">
		  <label class="form-label">å¹´é½¡å€é–“</label>
		  <div class="radio-card-group">
			<label class="radio-card">
			  <input type="radio" name="ageRange" value="18-25" required />
			  <span>18â€“25</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="ageRange" value="26-35" required />
			  <span>26â€“35</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="ageRange" value="36-45" required />
			  <span>36â€“45</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="ageRange" value="46-64" required />
			  <span>46â€“64</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="ageRange" value="65+" required />
			  <span>65ä»¥ä¸Š</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="ageRange" value="ä¸é™" required />
			  <span>ä¸é™</span>
			</label>
		  </div>
		</div>

		<div class="form-row">
		  <label class="form-label">ç­‰ç´š</label>
		  <div class="radio-card-group">
			<label class="radio-card">
			  <input type="radio" name="level" value="åˆå­¸" required />
			  <span>åˆå­¸</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="level" value="ä¸­éš" required />
			  <span>ä¸­éš</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="level" value="é€²éš" required />
			  <span>é€²éš</span>
			</label>
			<label class="radio-card">
			  <input type="radio" name="level" value="ä¸é™" required />
			  <span>ä¸é™</span>
			</label>
		  </div>
		</div>


    <div class="form-row">
      <label class="form-label">è£œå……èªªæ˜</label>
      <textarea name="description" placeholder="EXï¼šåœ°æ¨™æè¿°ã€è£å‚™å»ºè­°ã€æ³¨æ„äº‹é …..."></textarea>
    </div>
    <input type="hidden" id="location-lat" name="location_lat">
<input type="hidden" id="location-lng" name="location_lng">
     <button type="submit" class="btn-primary" id="single-submit-btn">ç™¼èµ·å–®å ‚èª²ç¨‹</button>
  </div>

  <!-- âœ… å¤šå ‚èª²ç¨‹è¡¨å–® -->
  <div id="multi-course-form" style="display: none;">
    <div class="form-row">
      <label class="form-label">ç¬¬ä¸€æ¬¡ä¸Šèª²æ™‚é–“</label>
      <input type="datetime-local" name="firstTime" required />
    </div>
    <div class="form-row">
      <label class="form-label">æ¯é€±ä¸Šèª²æ—¥ï¼ˆè¤‡é¸ï¼‰</label>
      <div class="weekday-group">
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="ä¸€" />
            é€±ä¸€
        </label>
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="äºŒ" />
            é€±äºŒ
        </label>
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="ä¸‰" />
            é€±ä¸‰
        </label>
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="å››" />
            é€±å››
        </label>
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="äº”" />
            é€±äº”
        </label>
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="å…­" />
            é€±å…­
        </label>
        <label class="weekday-btn">
            <input type="checkbox" name="weekdays" value="æ—¥" />
            é€±æ—¥
        </label>
      </div>
    </div>
    <div class="form-row">
      <label class="form-label">æ¯å ‚èª²é–‹å§‹æ™‚é–“</label>
      <input type="time" name="every_startTime" required />
    </div>
    <div class="form-row">
      <label class="form-label">æ¯å ‚èª²çµæŸæ™‚é–“</label>
      <input type="time" name="every_endTime" required />
    </div>
    <div class="form-row">
	  <label class="form-label">ç¸½å ‚æ•¸èˆ‡ç”¢ç”Ÿæ™‚é–“è¡¨</label>
	  <div class="half-row">
		<input type="number" name="multi_count" class="half-input" />
		<button type="button" class="btn-generate half-button" onclick="generateSchedule()">ç”¢ç”Ÿæ™‚é–“è¡¨</button>
	  </div>
	</div>
	<div class="form-row">
	  <label class="form-label">é è¦½èª²ç¨‹æ™‚é–“è¡¨</label>
	  <ul id="schedule-preview" class="dropdown-list"></ul>
	</div>

    <div class="form-row">
          <label class="form-label">äººæ•¸</label>
          <input
            type="number"
            name="multi_numPeople"
            placeholder="è«‹è¼¸å…¥æ­£ç¢ºäººæ•¸"
            required
            min="1"
          />
        </div>
    <div class="form-row">
      <label class="form-label">è²»ç”¨NTDï¼ˆæ¯ä½å­¸å“¡ï¼‰</label>
      <input type="number" name="multi_venue_fee" placeholder="è«‹è¼¸å…¥æ¯ä½å­¸å“¡è²»ç”¨" step="0.01" min="0" required />
    </div>
    <div class="form-row">
      <label class="form-label">å ±åæˆªæ­¢æ—¥æœŸ</label>
      <input type="datetime-local" name="multi_registration_deadline" required />
    </div>
		<div class="form-row">
	  <label class="form-label">æ€§åˆ¥</label>
	  <div class="radio-card-group">
		<label class="radio-card">
		  <input type="radio" name="multi_gender" value="ç”·æ€§" required />
		  <span>ç”·æ€§</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_gender" value="å¥³æ€§" required />
		  <span>å¥³æ€§</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_gender" value="ä¸é™" required />
		  <span>ä¸é™</span>
		</label>
	  </div>
	</div>

	<div class="form-row">
	  <label class="form-label">å¹´é½¡å€é–“</label>
	  <div class="radio-card-group">
		<label class="radio-card">
		  <input type="radio" name="multi_ageRange" value="18-25" required />
		  <span>18â€“25</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_ageRange" value="26-35" required />
		  <span>26â€“35</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_ageRange" value="36-45" required />
		  <span>36â€“45</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_ageRange" value="46-64" required />
		  <span>46â€“64</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_ageRange" value="65+" required />
		  <span>65ä»¥ä¸Š</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_ageRange" value="ä¸é™" required />
		  <span>ä¸é™</span>
		</label>
	  </div>
	</div>

	<div class="form-row">
	  <label class="form-label">ç­‰ç´š</label>
	  <div class="radio-card-group">
		<label class="radio-card">
		  <input type="radio" name="multi_level" value="åˆå­¸" required />
		  <span>åˆå­¸</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_level" value="ä¸­éš" required />
		  <span>ä¸­éš</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_level" value="é€²éš" required />
		  <span>é€²éš</span>
		</label>
		<label class="radio-card">
		  <input type="radio" name="multi_level" value="ä¸é™" required />
		  <span>ä¸é™</span>
		</label>
	  </div>
	</div>

    <div class="form-row">
      <label class="form-label">è£œå……èªªæ˜</label>
      <textarea name="multi_description" placeholder="EXï¼šåœ°æ¨™æè¿°ã€è£å‚™å»ºè­°ã€æ³¨æ„äº‹é …..."></textarea>
    </div>
    <input type="hidden" id="location-lat" name="location_lat">
<input type="hidden" id="location-lng" name="location_lng">
     <button type="submit" class="btn-primary" id="multi-submit-btn">ç™¼èµ·å¤šå ‚èª²ç¨‹</button>
  </div>

  
</form>

        
        
    <script>
	  let scheduleList = []; // å­˜ç›®å‰èª²è¡¨çš„é™£åˆ—
      const sportRadios = document.querySelectorAll('input[name="sport"]');
      const otherSportRow = document.getElementById("other-sport-row");
      const otherSportInput = document.getElementById("other-sport-input");
      const submitBtn = document.getElementById("submitBtn");

      sportRadios.forEach((radio) => {
        radio.addEventListener("change", function () {
          otherSportRow.style.display =
            this.value === "å…¶ä»–" ? "block" : "none";
          if (this.value !== "å…¶ä»–") otherSportInput.value = "";
        });
      });

        function selectCourseType(type) {
            const single = document.getElementById("single-course-form");
            const multi = document.getElementById("multi-course-form");
            const btnSingle = document.getElementById("btn-single");
            const btnMulti = document.getElementById("btn-multi");
            const singleSubmitBtn = document.getElementById("single-submit-btn");
            const multiSubmitBtn = document.getElementById("multi-submit-btn");

            if (type === "single") {
                single.style.display = "block";
                multi.style.display = "none";
                btnSingle.classList.add("active");
                btnMulti.classList.remove("active");
                singleSubmitBtn.style.display = "block";
                multiSubmitBtn.style.display = "none";
            } else {
                single.style.display = "none";
                multi.style.display = "block";
                btnSingle.classList.remove("active");
                btnMulti.classList.add("active");
                singleSubmitBtn.style.display = "none";
                multiSubmitBtn.style.display = "block";
            }
        }

           function togglePastTitles() {
            const list = document.getElementById("pastTitles");
            list.style.display = list.style.display === "none" ? "block" : "none";
            if (list.innerHTML.trim() === "") {
              const urlParams = new URLSearchParams(window.location.search);
              const memberId = urlParams.get("member_id");

              if (!memberId) {
                console.error("ç„¡æ³•å–å¾— member_id");
                return;
              }

              fetch(`/api/activities/past_class?member_id=${memberId}`)
                .then((response) => response.json())
                .then((data) => {
                  const uniqueTitles = new Set();
                  data.forEach((activity) => {
                    if (!uniqueTitles.has(activity.title)) {
                      uniqueTitles.add(activity.title);
                      const li = document.createElement("li");
                      li.textContent = `${activity.title} - ${activity.location_name}`;
                      li.style.cursor = "pointer";
                      li.addEventListener("click", () => {
                        document.querySelector('input[name="title"]').value = activity.title;
                        document.querySelector('input[name="location"]').value = activity.location_name;
                        const sportOptions = document.querySelectorAll('input[name="sport"]');
                        sportOptions.forEach((option) => {
                          if (option.value == activity.sport_type_id) {
                            option.checked = true;
                          }
                        });

                        // æ›´æ–°åœ°åœ–åœ°æ¨™
                        const lat = parseFloat(activity.location_lat);
                        const lng = parseFloat(activity.location_lng);
                        if (!isNaN(lat) && !isNaN(lng)) {
                          const location = { lat, lng };
                          map.setCenter(location);

                          if (marker) marker.setMap(null);
                          marker = new google.maps.Marker({
                            map: map,
                            position: location,
                            title: activity.location_name,
                          });

                          document.getElementById("location-lat").value = lat;
                          document.getElementById("location-lng").value = lng;
                        }

                        list.style.display = "none";
                      });
                      list.appendChild(li);
                    }
                  });
                })
                .catch((error) => console.error("Error fetching past classes:", error));
            }
          }


      fetch("/api/preferences/options")
        .then((response) => response.json())
        .then((data) => {
          const sportOptionsContainer =
            document.getElementById("sport-options");
          data.sport_types.forEach((sport) => {
            const label = document.createElement("label");
            label.className = "radio-card";
            label.innerHTML = `
              <input type="radio" name="sport" value="${sport.sport_type_id}" required />
              ${sport.name}
            `;
            sportOptionsContainer.appendChild(label);
          });
        })
        .catch((error) => console.error("Error fetching sport types:", error));

      const urlParams = new URLSearchParams(window.location.search);
      const memberId = urlParams.get("member_id");

      document
        .getElementById("single-submit-btn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          const formData = new FormData(document.getElementById("classForm"));

          const now = new Date();
          const registrationDeadline = new Date(formData.get("registration_deadline"));
          const startTime = new Date(formData.get("startTime"));
          const endTime = new Date(formData.get("endTime"));


          

          if (registrationDeadline <= now) {
            alert("å ±åæˆªæ­¢æ—¥æœŸå¿…é ˆåœ¨ç¾åœ¨æ™‚é–“ä¹‹å¾Œï¼");
            return;
          }

          if (startTime <= now) {
            alert("é–‹å§‹æ™‚é–“å¿…é ˆåœ¨ç¾åœ¨æ™‚é–“ä¹‹å¾Œï¼");
            return;
          }

          if (endTime <= now) {
            alert("çµæŸæ™‚é–“å¿…é ˆåœ¨ç¾åœ¨æ™‚é–“ä¹‹å¾Œï¼");
            return;
          }

          if (registrationDeadline >= startTime) {
            alert("å ±åæˆªæ­¢æ—¥æœŸå¿…é ˆæ—©æ–¼é–‹å§‹æ™‚é–“ï¼");
            return;
          }

          if (startTime >= endTime) {
            alert("é–‹å§‹æ™‚é–“å¿…é ˆæ—©æ–¼çµæŸæ™‚é–“ï¼");
            return;
          }

          

          if (!confirm("ç¢ºå®šè¦ç™¼èµ·èª²ç¨‹å—ï¼Ÿ")) {
            return;
          }

          const data = {
            title: formData.get("title"),
            first_time: formData.get("firstTime"),
            start_time: formData.get("startTime"),
            end_time: formData.get("endTime"),
            every_starttime: formData.get("every_startTime"),
            every_endtime: formData.get("every_endTime"),
            weekdays: formData.getAll("weekdays"),
            multi_count: parseInt(formData.get("multi_count")),
            location_name: document.getElementById("place-input").value,
            location_lat: parseFloat(document.getElementById("location-lat").value),
  location_lng: parseFloat(document.getElementById("location-lng").value),
            max_participants: parseInt(formData.get("numPeople")),
            venue_fee: parseFloat(formData.get("venue_fee")),
            registration_deadline: formData.get("registration_deadline"),
            organizer_id: memberId, // ä½¿ç”¨ç¶²å€ä¸­çš„ member_id
            level: formData.get("level"),
            gender: formData.get("gender"),
            age_range: formData.get("ageRange"),
            sport_type_id: parseInt(formData.get("sport")),
            description: formData.get("description"),
            status: "open",
          };

          fetch("/api/activities/class", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          })
            .then((res) => {
              if (res.ok) {
                alert("èª²ç¨‹ç™¼èµ·æˆåŠŸï¼");
                window.location.href = `/activity?member_id=${memberId}`;
              } else {
                alert("èª²ç¨‹ç™¼èµ·å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
              }
            })
            .catch((err) => {
              console.error("éŒ¯èª¤:", err);
              alert("ç™¼èµ·èª²ç¨‹æ™‚å‡ºéŒ¯ï¼");
            });
        });

      document
        .getElementById("multi-submit-btn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          const formData = new FormData(document.getElementById("classForm"));

          const now = new Date();
          const registrationDeadline = new Date(formData.get("multi_registration_deadline"));
          const firstTime = new Date(formData.get("firstTime"));
          const everyStartTime = new Date(formData.get("every_startTime"));
          const everyEndTime = new Date(formData.get("every_endTime"));

          if (everyStartTime && everyEndTime) {
            if (everyStartTime >= everyEndTime) {
              alert("æ¯å ‚èª²é–‹å§‹æ™‚é–“å¿…é ˆåœ¨çµæŸæ™‚é–“ä¹‹å‰ï¼");
              return;
            }
          }

          if (registrationDeadline <= now) {
            alert("å ±åæˆªæ­¢æ—¥æœŸå¿…é ˆåœ¨ç¾åœ¨æ™‚é–“ä¹‹å¾Œï¼");
            return;
          }

          if (!isNaN(firstTime.getTime())) {
            if (firstTime <= now) {
              alert("ç¬¬ä¸€æ¬¡ä¸Šèª²æ™‚é–“å¿…é ˆåœ¨ç¾åœ¨æ™‚é–“ä¹‹å¾Œï¼");
              return;
            }

            if (registrationDeadline >= firstTime) {
              alert("å ±åæˆªæ­¢æ—¥æœŸå¿…é ˆæ—©æ–¼ç¬¬ä¸€æ¬¡ä¸Šèª²æ™‚é–“ï¼");
              return;
            }
          }

          if (!confirm("ç¢ºå®šè¦ç™¼èµ·å¤šå ‚èª²ç¨‹å—ï¼Ÿ")) {
            return;
          }

          const data = {
            title: formData.get("title"),
            sport_type_id: parseInt(formData.get("sport")),
            first_time: formData.get("firstTime"),
            every_starttime: formData.get("every_startTime"),
            every_endtime: formData.get("every_endTime"),
            weekdays: formData.getAll("weekdays"),
            multi_count: parseInt(formData.get("multi_count")),
            max_participants: parseInt(formData.get("multi_numPeople")),
            gender: formData.get("multi_gender"),
            age_range: formData.get("multi_ageRange"),
            level: formData.get("multi_level"),
            location_name: document.getElementById("place-input").value,
            location_lat: parseFloat(document.getElementById("location-lat").value),
  location_lng: parseFloat(document.getElementById("location-lng").value),
            venue_fee: parseFloat(formData.get("multi_venue_fee")),
            registration_deadline: formData.get("multi_registration_deadline"),
            organizer_id: memberId, // ä½¿ç”¨ç¶²å€ä¸­çš„ member_id
            description: formData.get("multi_description"),
            status: "open",
            scheduleList: scheduleList, // æ·»åŠ  scheduleList
          };

          fetch("/api/activities/multiclass", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          })
            .then((res) => {
              if (res.ok) {
                alert("å¤šå ‚èª²ç¨‹ç™¼èµ·æˆåŠŸï¼");
                window.location.href = `/activity?member_id=${memberId}`;
              } else {
                alert("å¤šå ‚èª²ç¨‹ç™¼èµ·å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
              }
            })
            .catch((err) => {
              console.error("éŒ¯èª¤:", err);
              alert("ç™¼èµ·å¤šå ‚èª²ç¨‹æ™‚å‡ºéŒ¯ï¼");
            });
        });

      function sportNameToId(sport) {
        const mapping = {
          è·‘æ­¥: 1,
          ç¾½çƒ: 2,
          ç‘œçˆ: 3,
          å¥èº«: 4,
          é¨å–®è»Š: 5,
          ç±ƒçƒ: 6,
          æ¸¸æ³³: 7,
          æ’çƒ: 8,
          ç¶²çƒ: 9,
          æ£’çƒ: 10,
          è¶³çƒ: 11,
        };
        return mapping[sport] || 0;
			  }
			 function generateSchedule() {
		  const firstTimeInput = document.querySelector('input[name="firstTime"]');
		  const weekdayInputs = document.querySelectorAll('input[name="weekdays"]:checked');
		  const startTimeInput = document.querySelector('input[name="every_startTime"]');
		  const endTimeInput = document.querySelector('input[name="every_endTime"]');
		  const countInput = document.querySelector('input[name="multi_count"]');
		  const previewList = document.getElementById("schedule-preview");

		  previewList.innerHTML = "";
		  scheduleList = []; // æ¸…ç©ºèˆŠè³‡æ–™

		  const firstDate = new Date(firstTimeInput.value);
		  if (isNaN(firstDate)) {
			alert("è«‹å…ˆè¼¸å…¥ç¬¬ä¸€æ¬¡ä¸Šèª²æ™‚é–“");
			return;
		  }

		  const weekdays = Array.from(weekdayInputs).map(input => input.value);
		  if (weekdays.length === 0) {
			alert("è«‹é¸æ“‡æ¯é€±ä¸Šèª²æ—¥");
			return;
		  }

		  const startTime = startTimeInput.value;
		  const endTime = endTimeInput.value;
		  const totalCount = parseInt(countInput.value);
		  if (!startTime || !endTime || isNaN(totalCount) || totalCount <= 0) {
			alert("è«‹å®Œæ•´è¼¸å…¥æ™‚é–“èˆ‡å ‚æ•¸");
			return;
		  }

		  const weekdayMap = { "æ—¥": 0, "ä¸€": 1, "äºŒ": 2, "ä¸‰": 3, "å››": 4, "äº”": 5, "å…­": 6 };
		  const targetWeekdays = weekdays.map(w => weekdayMap[w]);

		  let date = new Date(firstDate);
		  while (scheduleList.length < totalCount) {
			if (targetWeekdays.includes(date.getDay())) {
			  const dateStr = date.toISOString().split("T")[0];
			  scheduleList.push(`${dateStr} ${startTime} ~ ${endTime}`);
			}
			date.setDate(date.getDate() + 1);
		  }

		  renderScheduleList();
		}
		function renderScheduleList() {
		  const previewList = document.getElementById("schedule-preview");
		  previewList.innerHTML = "";

		  scheduleList.forEach((line, index) => {
			const li = document.createElement("li");
			li.innerHTML = `ç¬¬ ${index + 1} å ‚ï¼š${line} 
			  <button type="button" onclick="deleteSchedule(${index})" 
				style="margin-left: 8px; color: red; border: none; background: none; cursor: pointer;">âœ–</button>`;
			previewList.appendChild(li);
		  });

		  // âœ… è‡ªå‹•æ›´æ–°ç¸½å ‚æ•¸æ¬„ä½
		  const countInput = document.querySelector('input[name="multi_count"]');
		  countInput.value = scheduleList.length;
		}

		function deleteSchedule(index) {
		  if (!confirm(`ä½ ç¢ºå®šè¦åˆªé™¤ç¬¬ ${index + 1} å ‚èª²å—ï¼Ÿ`)) return;
		  scheduleList.splice(index, 1); // åˆªæ‰è©²å ‚èª²
		  renderScheduleList(); // é‡æ–°æ¸²æŸ“æ¸…å–®
		}


    </script>
    <!-- Google Maps JS è¼‰å…¥ -->
    <script>
      let map, marker, autocomplete;

function initAutocomplete() {
  console.log("âœ… initAutocomplete å·²åŸ·è¡Œï¼");

  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 25.0330, lng: 121.5654 },
    zoom: 15,
  });

  const input = document.getElementById("place-input");
  autocomplete = new google.maps.places.Autocomplete(input, {
    types: ["geocode"],
    componentRestrictions: { country: "tw" },
  });

  autocomplete.addListener("place_changed", () => {
    const place = autocomplete.getPlace();
    console.log("ğŸ“ ä½¿ç”¨è€…é¸æ“‡åœ°é»ï¼š", place);

    if (!place.geometry || !place.geometry.location) {
      alert("æ‰¾ä¸åˆ°æ­¤åœ°å€çš„åœ°ç†ä½ç½®ï¼Œè«‹é‡æ–°è¼¸å…¥ï¼");
      return;
    }

    const location = place.geometry.location;
    const lat = location.lat();
    const lng = location.lng();

    map.setCenter(location);

    if (marker) marker.setMap(null);
    marker = new google.maps.Marker({
      map: map,
      position: location,
      title: place.name || input.value,
    });

    // âœ… é€™å…©è¡Œä¸€å®šè¦å…ˆè¨­å®šï¼ˆå°‡ç·¯åº¦ç¶“ç·¯åº¦å¡«å…¥éš±è—æ¬„ä½ï¼‰
    document.getElementById("location-lat").value = lat;
    document.getElementById("location-lng").value = lng;

    // âœ… é€™å…©è¡Œæ˜¯ç”¨ä¾†ç¢ºèªä½ æ˜¯å¦æ­£ç¢ºæŠ“åˆ°
    console.log("âœ… ç·¯åº¦ lat:", lat);
    console.log("âœ… ç¶“åº¦ lng:", lng);
  });
}
    </script>
    
    <!-- âœ… å°‡ Google Maps çš„ script æ”¾åˆ°æœ€ä¸‹æ–¹ -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjPPoRxjshMgepTKlniZst9G4fgpqQkQk&libraries=places&callback=initAutocomplete" defer></script>
    </body>
    </html>