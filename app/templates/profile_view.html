<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員資料</title>
    <style>
      :root {
        --main-color: #81d3e1;
        --deep-blue: #2c4975;
        --text-color: #444;
        --bg-color: #fdf9ed;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-color);
        margin: 0;
        padding: 40px 20px;
      }
      .profile-card {
        max-width: 600px;
        margin: 0 auto;
        background: #fff;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      }
      .avatar-wrapper {
        width: 140px;
        height: 140px;
        margin: 0 auto 20px;
      }
      .profile-avatar {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--main-color);
      }
      .profile-info {
        margin-top: 20px;
      }
      .profile-info h2 {
        text-align: center;
        color: var(--deep-blue);
        margin-bottom: 10px;
      }
      .profile-row {
        display: flex;
        margin: 6px 0;
      }
      .label {
        width: 100px;
        color: var(--deep-blue);
        font-weight: 600;
      }
      .value {
        color: var(--text-color);
        font-size: 16px;
      }
      .btn-group {
        text-align: center;
        margin-top: 30px;
      }
      .btn-group a {
        display: inline-block;
        margin: 0 8px;
        padding: 10px 24px;
        background: var(--main-color);
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        transition: background 0.2s;
      }
      .btn-group a:hover {
        background: var(--deep-blue);
      }
    </style>
  </head>
  <body>
    <div class="profile-card">
      <div class="avatar-wrapper">
        <img
          id="avatarImage"
          class="profile-avatar"
          src="{{ url_for('static', filename='avatars/' + member_id + '.png') }}"
          alt="會員頭像"
          onerror="this.src='{{ url_for('static', filename='avatars/default.jpg') }}';"
        />
      </div>
      <div class="profile-info">
        <h2 id="name">會員姓名</h2>
        <div class="profile-row">
          <span class="label">Email：</span
          ><span class="value" id="email"></span>
        </div>
        <div class="profile-row">
          <span class="label">性別：</span
          ><span class="value" id="gender"></span>
        </div>
        <div class="profile-row">
          <span class="label">生日：</span
          ><span class="value" id="birthdate"></span>
        </div>
        <div class="profile-row">
          <span class="label">身高：</span
          ><span class="value" id="height"></span> cm
        </div>
        <div class="profile-row">
          <span class="label">體重：</span
          ><span class="value" id="weight"></span> kg
        </div>
        <div class="profile-row">
          <span class="label">地區：</span
          ><span class="value" id="location"></span>
        </div>
        <hr style="margin: 16px 0" />
        <div class="profile-row">
          <span class="label">喜好運動：</span
          ><span class="value" id="sports"></span>
        </div>
        <div class="profile-row">
          <span class="label">偏好性別：</span
          ><span class="value" id="match-gender"></span>
        </div>
        <div class="profile-row">
          <span class="label">偏好年齡：</span
          ><span class="value" id="match-age"></span>
        </div>
        <div class="profile-row">
          <span class="label">平日時段：</span
          ><span class="value" id="times-weekday"></span>
        </div>
        <div class="profile-row">
          <span class="label">週末時段：</span
          ><span class="value" id="times-weekend"></span>
        </div>
      </div>
      <div class="btn-group">
        <a href="/home?member_id={{ member_id }}">← 返回首頁</a>
        <a href="/profile/edit?member_id={{ member_id }}">編輯資料</a>
      </div>
    </div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const memberId = params.get("member_id");
      async function fetchData() {
        const res = await fetch(`/api/members/${memberId}`);
        const data = await res.json();
        document.getElementById("name").textContent = data.name || "未填寫";
        document.getElementById("email").textContent = data.email || "未填寫";
        const gMap = { m: "男", f: "女" ,male: '男',female: '女',};
        document.getElementById("gender").textContent =
          gMap[data.gender] || data.gender || "未填寫";
        if (data.birthdate) {
          const [y, m] = data.birthdate.split("-");
          const age =
            new Date().getFullYear() -
            +y -
            (new Date().getMonth() < +m - 1 ? 1 : 0);
          document.getElementById(
            "birthdate"
          ).textContent = `${y}年${m}月（${age}歲）`;
        }
        document.getElementById("height").textContent = data.height || "未填寫";
        document.getElementById("weight").textContent = data.weight || "未填寫";
        document.getElementById("location").textContent =
          `${data.city || ""}${data.area ? "/" + data.area : ""}` || "未填寫";
        const p = data.sport_preferences || {};
        document.getElementById("sports").textContent =
          (p.sports || []).join("、") || "未填寫";
        document.getElementById("match-gender").textContent =
          p.match_gender || "未填寫";
        document.getElementById("match-age").textContent =
          p.match_age || "未填寫";
        const wk = (p.times?.weekday || []).join("、") || "未填寫";
        const we = (p.times?.weekend || []).join("、") || "未填寫";
        document.getElementById("times-weekday").textContent = wk;
        document.getElementById("times-weekend").textContent = we;
      }
      fetchData();
    </script>
  </body>
</html>
