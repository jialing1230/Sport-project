<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÊúÉÂì°Âü∫Êú¨Ë≥áÊñô</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      .container {
        position: relative;
        max-width: 800px;
        width: 100%;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }
      .form-box {
        flex: 1 1 300px;
        display: flex;
        flex-direction: column;
      }
      .image-box {
        flex: 1 1 300px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .image-box img {
        max-width: 100%;
        max-height: 300px;
        object-fit: contain;
        border-radius: 6px;
      }
      .title-row {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        margin-bottom: 30px;
      }
      .logo-inline {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: contain;
      }
      h1 {
        margin: 0;
        font-size: 24px;
        color: #2c4975;
        white-space: nowrap;
      }
      .required-star {
        color: red;
        margin-left: 5px;
        font-size: 18px;
      }
      .form-row {
        margin-bottom: 15px;
        width: 100%;
        display: flex;
        flex-direction: column;
      }
      .form-label {
        font-weight: bold;
        margin-bottom: 6px;
        color: #2c4975;
        white-space: nowrap;
      }
      .form-input,
      .form-select {
        padding: 10px;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #fff;
      }
      #avatarInput {
        display: none;
      }
      .avatar-wrapper {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }
      #avatarPreview {
        width: 120px;
        height: 120px;
        border: 2px dashed #ccc;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        position: relative;
        background-color: #fff;
      }
      #avatarPreview.uploaded {
        border-color: #2c4975;
      }
      #avatarPreview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }
      .remove-avatar-btn {
        position: absolute;
        top: -8px;
        right: -8px;
        background: none;
        border: none;
        color: #2c4975;
        font-size: 24px;
        font-weight: 900;
        cursor: pointer;
        transition: color 0.2s, transform 0.2s;
      }
      .remove-avatar-btn:hover {
        color: #1f3555;
        transform: scale(1.2);
      }
      .gender-options {
        display: flex;
        gap: 20px;
        margin-top: 6px;
      }
      .btn-primary {
        background-color: #81d3e1;
        color: white;
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        transition: 0.2s;
      }
      .btn-primary:hover {
        background-color: #2c4975;
      }
      #cropModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }
      #cropContainer {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        max-width: 90vw;
        max-height: 90vh;
      }
      #cropImage {
        max-width: 100%;
        max-height: 60vh;
        display: block;
      }
      #cropConfirm {
        margin-top: 10px;
        padding: 8px 16px;
        background: #2c4975;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      @media (max-width: 768px) {
        .container {
          flex-direction: column;
          padding: 10px;
        }
        .image-box {
          display: none;
        }
        .form-box {
          min-width: 0;
        }
        .title-row {
          gap: 8px;
          margin-bottom: 18px;
        }
        h1 {
          font-size: 20px;
        }
        .form-row {
          margin-bottom: 10px;
        }
        .form-label {
          font-size: 15px;
        }
        .form-input, .form-select {
          font-size: 15px;
        }
        .btn-primary {
          font-size: 15px;
          padding: 8px 0;
        }
      }
      @media (max-width: 480px) {
        .container {
          padding: 2px;
        }
        h1 {
          font-size: 17px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="form-box">
        <div class="title-row">
          <img
            src="{{ url_for('static', filename='logo.jpg') }}"
            alt="Logo"
            class="logo-inline"
          />
          <h1>Âü∫Êú¨Ë≥áÊñô</h1>
        </div>

        <div class="form-row">
          <label class="form-label">‰∏äÂÇ≥È†≠ÂÉè</label>
          <input type="file" id="avatarInput" accept="image/*" />
          <div class="avatar-wrapper">
            <div id="avatarPreview">ÈªûÊìä‰∏äÂÇ≥</div>
          </div>
        </div>

        <form id="profileForm">
          <div class="form-row">
            <label class="form-label" for="name"
              >ÂßìÂêç<span class="required-star">*</span></label
            >
            <input type="text" id="name" class="form-input" required />
          </div>
          <div class="form-row">
            <label class="form-label"
              >Âá∫ÁîüÂπ¥Êúà<span class="required-star">*</span></label
            >
            <div style="display: flex; gap: 10px">
              <select id="birth-year" class="form-select" required>
                <option value="">Âπ¥</option>
              </select>
              <select id="birth-month" class="form-select" required>
                <option value="">Êúà</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <label class="form-label"
              >ÊÄßÂà•<span class="required-star">*</span></label
            >
            <div class="gender-options">
              <label>
                <input type="radio" name="gender" value="Áî∑" required />Áî∑
              </label>
              <label>
                <input type="radio" name="gender" value="Â•≥" required />Â•≥
              </label>
            </div>
          </div>
          <div class="form-row">
            <label class="form-label">Ë∫´È´òÈ´îÈáç</label>
            <div style="display: flex; gap: 10px">
              <input
                type="number"
                id="height"
                class="form-input"
                placeholder="Ë∫´È´ò (cm)"
                min="100"
                max="250"
                required
              />
              <input
                type="number"
                id="weight"
                class="form-input"
                placeholder="È´îÈáç (kg)"
                min="30"
                max="200"
                required
              />
            </div>
          </div>
          <div class="form-row">
            <label class="form-label"
              >Â±Ö‰ΩèÂú∞ÂçÄ<span class="required-star">*</span></label
            >
            <div style="display: flex; gap: 10px">
              <select id="city" class="form-select" required>
                <option value="">Á∏£Â∏Ç</option>
              </select>
              <select id="district" class="form-select" required>
                <option value="">ÈÑâÈéÆÂçÄ</option>
              </select>
            </div>
          </div>

          <button type="submit" class="btn-primary">‰∏ã‰∏ÄÊ≠•</button>
        </form>
      </div>

      <div class="image-box">
        <img
          src="{{ url_for('static', filename='logo.jpg') }}"
          alt="illustration"
        />
      </div>
    </div>

    <div id="cropModal">
      <div id="cropContainer">
        <img id="cropImage" src="" alt="Ë£ÅÂâ™ÂúñÁâá" />
        <button id="cropConfirm">ÂÆåÊàêË£ÅÂâ™</button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
      const MEMBER_ID = "{{ member_id }}";
      if (!MEMBER_ID) {
        alert("Áº∫Â∞ë member_idÔºåË´ãÈáçÊñ∞ÁôªÂÖ•");
        window.location.href = "/login";
      }

      let croppedBlob = null;
      const avatarInput = document.getElementById("avatarInput");
      const avatarPreview = document.getElementById("avatarPreview");
      const cropModal = document.getElementById("cropModal");
      const cropImage = document.getElementById("cropImage");
      const cropConfirm = document.getElementById("cropConfirm");
      let cropper;

      avatarPreview.addEventListener("click", () => avatarInput.click());
      avatarInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file || !file.type.startsWith("image/")) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          cropImage.src = ev.target.result;
          cropModal.style.display = "flex";
          cropper && cropper.destroy();
          cropper = new Cropper(cropImage, {
            aspectRatio: 1,
            viewMode: 1,
            autoCropArea: 1,
            background: false,
            guides: false,
          });
        };
        reader.readAsDataURL(file);
      });

      cropConfirm.addEventListener("click", () => {
        cropper.getCroppedCanvas({ width: 300, height: 300 }).toBlob((blob) => {
          croppedBlob = blob;
          const url = URL.createObjectURL(blob);
          avatarPreview.classList.add("uploaded");
          avatarPreview.innerHTML = `
              <div style="position:relative;width:100%;height:100%;">
                <img src="${url}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;"/>
                <button id="removeAvatar" class="remove-avatar-btn">‚úï</button>
              </div>`;
          document
            .getElementById("removeAvatar")
            .addEventListener("click", (ev) => {
              ev.stopPropagation();
              avatarPreview.innerHTML = "ÈªûÊìä‰∏äÂÇ≥";
              avatarPreview.classList.remove("uploaded");
              avatarInput.value = "";
              croppedBlob = null;
            });
          cropModal.style.display = "none";
          cropper.destroy();
        }, "image/png");
      });

      const yearSel = document.getElementById("birth-year"),
        monSel = document.getElementById("birth-month");
      const thisYr = new Date().getFullYear();
      for (let y = thisYr - 100; y <= thisYr; y++) {
        let o = document.createElement("option");
        o.value = y;
        o.text = `${y} Âπ¥`;
        yearSel.appendChild(o);
      }
      for (let m = 1; m <= 12; m++) {
        let o = document.createElement("option");
        o.value = String(m).padStart(2, "0");
        o.text = `${m} Êúà`;
        monSel.appendChild(o);
      }

      const cityDistrictData = {
        Âè∞ÂåóÂ∏Ç: [
          "‰∏≠Ê≠£ÂçÄ",
          "Â§ßÂêåÂçÄ",
          "‰∏≠Â±±ÂçÄ",
          "ÊùæÂ±±ÂçÄ",
          "Â§ßÂÆâÂçÄ",
          "Ëê¨ËèØÂçÄ",
          "‰ø°Áæ©ÂçÄ",
          "Â£´ÊûóÂçÄ",
          "ÂåóÊäïÂçÄ",
          "ÂÖßÊπñÂçÄ",
          "ÂçóÊ∏ØÂçÄ",
          "ÊñáÂ±±ÂçÄ",
        ],
        Êñ∞ÂåóÂ∏Ç: [
          "ÊùøÊ©ãÂçÄ",
          "‰∏âÈáçÂçÄ",
          "‰∏≠ÂíåÂçÄ",
          "Ê∞∏ÂíåÂçÄ",
          "Êñ∞ËéäÂçÄ",
          "Êñ∞Â∫óÂçÄ",
          "ÂúüÂüéÂçÄ",
          "Ê®πÊûóÂçÄ",
          "È∂ØÊ≠åÂçÄ",
          "‰∏âÂ≥ΩÂçÄ",
          "Ê∑°Ê∞¥ÂçÄ",
          "Ê±êÊ≠¢ÂçÄ",
          "ÁëûËä≥ÂçÄ",
          "ËòÜÊ¥≤ÂçÄ",
          "‰∫îËÇ°ÂçÄ",
          "Ê≥∞Â±±ÂçÄ",
          "ÊûóÂè£ÂçÄ",
          "Ê∑±ÂùëÂçÄ",
          "Áü≥Á¢áÂçÄ",
          "Âù™ÊûóÂçÄ",
          "‰∏âËäùÂçÄ",
          "Áü≥ÈñÄÂçÄ",
          "ÂÖ´ÈáåÂçÄ",
          "Âπ≥Ê∫™ÂçÄ",
          "ÈõôÊ∫™ÂçÄ",
          "Ë≤¢ÂØÆÂçÄ",
          "ÈáëÂ±±ÂçÄ",
          "Ëê¨ÈáåÂçÄ",
          "ÁÉè‰æÜÂçÄ",
        ],
        Âü∫ÈöÜÂ∏Ç: [
          "‰ªÅÊÑõÂçÄ",
          "‰ø°Áæ©ÂçÄ",
          "‰∏≠Ê≠£ÂçÄ",
          "‰∏≠Â±±ÂçÄ",
          "ÂÆâÊ®ÇÂçÄ",
          "ÊöñÊöñÂçÄ",
          "‰∏ÉÂ†µÂçÄ",
        ],
        Ê°ÉÂúíÂ∏Ç: [
          "Ê°ÉÂúíÂçÄ",
          "‰∏≠Â£¢ÂçÄ",
          "Âπ≥ÈéÆÂçÄ",
          "ÂÖ´Âæ∑ÂçÄ",
          "Ê•äÊ¢ÖÂçÄ",
          "ËòÜÁ´πÂçÄ",
          "Â§ßÂúíÂçÄ",
          "ÈæúÂ±±ÂçÄ",
          "Â§ßÊ∫™ÂçÄ",
          "ÈæçÊΩ≠ÂçÄ",
          "Êñ∞Â±ãÂçÄ",
          "ËßÄÈü≥ÂçÄ",
          "Âæ©ËààÂçÄ",
        ],
        Êñ∞Á´πÂ∏Ç: ["Êù±ÂçÄ", "ÂåóÂçÄ", "È¶ôÂ±±ÂçÄ"],
        Êñ∞Á´πÁ∏£: [
          "Á´πÂåóÂ∏Ç",
          "Á´πÊù±ÈéÆ",
          "Êñ∞Ë±êÈÑâ",
          "ÊπñÂè£ÈÑâ",
          "Êñ∞ÂüîÈéÆ",
          "ÈóúË•øÈéÆ",
          "ËäéÊûóÈÑâ",
          "ÂØ∂Â±±ÈÑâ",
          "ÂåóÂüîÈÑâ",
          "Â≥®ÁúâÈÑâ",
          "Ê©´Â±±ÈÑâ",
          "Â∞ñÁü≥ÈÑâ",
          "‰∫îÂ≥∞ÈÑâ",
        ],
        ÂÆúËò≠Á∏£: [
          "ÂÆúËò≠Â∏Ç",
          "ÁæÖÊù±ÈéÆ",
          "ËòáÊæ≥ÈéÆ",
          "È†≠ÂüéÈéÆ",
          "Á§ÅÊ∫™ÈÑâ",
          "Â£ØÂúçÈÑâ",
          "Âì°Â±±ÈÑâ",
          "ÂÜ¨Â±±ÈÑâ",
          "‰∫îÁµêÈÑâ",
          "‰∏âÊòüÈÑâ",
          "Â§ßÂêåÈÑâ",
          "ÂçóÊæ≥ÈÑâ",
        ],
        ËãóÊ†óÁ∏£: [
          "ËãóÊ†óÂ∏Ç",
          "È†≠‰ªΩÂ∏Ç",
          "ËãëË£°ÈéÆ",
          "ÈÄöÈúÑÈéÆ",
          "Á´πÂçóÈéÆ",
          "ÂæåÈæçÈéÆ",
          "ÂçìËò≠ÈéÆ",
          "Ë•øÊπñÈÑâ",
          "ÈÄ†Ê©ãÈÑâ",
          "‰∏âÁÅ£ÈÑâ",
          "ÂçóÂ∫ÑÈÑâ",
          "È†≠Â±ãÈÑâ",
          "ÂÖ¨È§®ÈÑâ",
          "Â§ßÊπñÈÑâ",
          "ÁçÖÊΩ≠ÈÑâ",
          "Ê≥∞ÂÆâÈÑâ",
        ],
        Âè∞‰∏≠Â∏Ç: [
          "‰∏≠ÂçÄ",
          "Êù±ÂçÄ",
          "ÂçóÂçÄ",
          "Ë•øÂçÄ",
          "ÂåóÂçÄ",
          "Ë•øÂ±ØÂçÄ",
          "ÂåóÂ±ØÂçÄ",
          "ÂçóÂ±ØÂçÄ",
          "Â§™Âπ≥ÂçÄ",
          "Â§ßÈáåÂçÄ",
          "ÈúßÂ≥∞ÂçÄ",
          "ÁÉèÊó•ÂçÄ",
          "Ë±êÂéüÂçÄ",
          "ÂêéÈáåÂçÄ",
          "Êù±Âã¢ÂçÄ",
          "Áü≥Â≤°ÂçÄ",
          "Êñ∞Á§æÂçÄ",
          "ÂíåÂπ≥ÂçÄ",
          "Á•ûÂ≤°ÂçÄ",
          "ÊΩ≠Â≠êÂçÄ",
          "Â§ßÈõÖÂçÄ",
          "Â§ßËÇöÂçÄ",
          "Èæç‰∫ïÂçÄ",
          "Ê≤ôÈπøÂçÄ",
          "Ê∏ÖÊ∞¥ÂçÄ",
          "Ê¢ßÊ£≤ÂçÄ",
          "Â§ßÁî≤ÂçÄ",
          "Â§ñÂüîÂçÄ",
          "Â§ßÂÆâÂçÄ",
        ],
        ÂΩ∞ÂåñÁ∏£: [
          "ÂΩ∞ÂåñÂ∏Ç",
          "Âì°ÊûóÂ∏Ç",
          "ÂíåÁæéÈéÆ",
          "ÈπøÊ∏ØÈéÆ",
          "Ê∫™ÊπñÈéÆ",
          "Áî∞‰∏≠ÈéÆ",
          "ÂåóÊñóÈéÆ",
          "Ëä±Â£áÈÑâ",
          "Ëä¨ÂúíÈÑâ",
          "Á¶èËààÈÑâ",
          "ÁßÄÊ∞¥ÈÑâ",
          "ÂüîÂøÉÈÑâ",
          "Ê∞∏ÈùñÈÑâ",
          "Á§æÈ†≠ÈÑâ",
          "‰∫åÊ∞¥ÈÑâ",
          "Áî∞Â∞æÈÑâ",
          "Âü§È†≠ÈÑâ",
          "Ëä≥ËãëÈÑâ",
          "Â§ßÊùëÈÑâ",
          "Á´πÂ°òÈÑâ",
          "Ê∫™Â∑ûÈÑâ",
        ],
        ÂçóÊäïÁ∏£: [
          "ÂçóÊäïÂ∏Ç",
          "ÂüîÈáåÈéÆ",
          "ËçâÂ±ØÈéÆ",
          "Á´πÂ±±ÈéÆ",
          "ÈõÜÈõÜÈéÆ",
          "ÂêçÈñìÈÑâ",
          "ÈπøË∞∑ÈÑâ",
          "‰∏≠ÂØÆÈÑâ",
          "È≠öÊ±†ÈÑâ",
          "ÂúãÂßìÈÑâ",
          "Ê∞¥ÈáåÈÑâ",
          "‰ø°Áæ©ÈÑâ",
          "‰ªÅÊÑõÈÑâ",
        ],
        Èõ≤ÊûóÁ∏£: [
          "ÊñóÂÖ≠Â∏Ç",
          "ÊñóÂçóÈéÆ",
          "ËôéÂ∞æÈéÆ",
          "Ë•øËû∫ÈéÆ",
          "ÂúüÂ∫´ÈéÆ",
          "ÂåóÊ∏ØÈéÆ",
          "Âè§ÂùëÈÑâ",
          "Â§ßÂü§ÈÑâ",
          "ËéøÊ°êÈÑâ",
          "ÊûóÂÖßÈÑâ",
          "‰∫åÂ¥ôÈÑâ",
          "Â¥ôËÉåÈÑâ",
          "È∫•ÂØÆÈÑâ",
          "Êù±Âã¢ÈÑâ",
          "Ë§íÂø†ÈÑâ",
          "Ëá∫Ë•øÈÑâ",
          "ÂÖÉÈï∑ÈÑâ",
          "ÂõõÊπñÈÑâ",
          "Âè£ÊπñÈÑâ",
          "Ê∞¥ÊûóÈÑâ",
        ],
        ÂòâÁæ©Â∏Ç: ["Êù±ÂçÄ", "Ë•øÂçÄ"],
        ÂòâÁæ©Á∏£: [
          "Â§™‰øùÂ∏Ç",
          "Êú¥Â≠êÂ∏Ç",
          "Â∏ÉË¢ãÈéÆ",
          "Â§ßÊûóÈéÆ",
          "Ê∞ëÈõÑÈÑâ",
          "Ê∫™Âè£ÈÑâ",
          "Êñ∞Ê∏ØÈÑâ",
          "ÂÖ≠ËÖ≥ÈÑâ",
          "Êù±Áü≥ÈÑâ",
          "Áæ©Á´πÈÑâ",
          "ÈπøËçâÈÑâ",
          "Ê∞¥‰∏äÈÑâ",
          "‰∏≠ÂüîÈÑâ",
          "Á´πÂ¥éÈÑâ",
          "Ê¢ÖÂ±±ÈÑâ",
          "Áï™Ë∑ØÈÑâ",
          "Â§ßÂüîÈÑâ",
          "ÈòøÈáåÂ±±ÈÑâ",
        ],
        Âè∞ÂçóÂ∏Ç: [
          "‰∏≠Ë•øÂçÄ",
          "Êù±ÂçÄ",
          "ÂçóÂçÄ",
          "ÂåóÂçÄ",
          "ÂÆâÂπ≥ÂçÄ",
          "ÂÆâÂçóÂçÄ",
          "Ê∞∏Â∫∑ÂçÄ",
          "Ê≠∏‰ªÅÂçÄ",
          "Êñ∞ÂåñÂçÄ",
          "Â∑¶ÈéÆÂçÄ",
          "Áéâ‰∫ïÂçÄ",
          "Ê•†Ë•øÂçÄ",
          "ÂçóÂåñÂçÄ",
          "‰ªÅÂæ∑ÂçÄ",
          "ÈóúÂªüÂçÄ",
          "ÈæçÂ¥éÂçÄ",
          "ÂÆòÁî∞ÂçÄ",
          "È∫ªË±ÜÂçÄ",
          "‰Ω≥ÈáåÂçÄ",
          "Ë•øÊ∏ØÂçÄ",
          "‰∏ÉËÇ°ÂçÄ",
          "Â∞áËªçÂçÄ",
          "Â≠∏Áî≤ÂçÄ",
          "ÂåóÈñÄÂçÄ",
          "Êñ∞ÁáüÂçÄ",
          "ÂæåÂ£ÅÂçÄ",
          "ÁôΩÊ≤≥ÂçÄ",
          "Êù±Â±±ÂçÄ",
          "ÂÖ≠Áî≤ÂçÄ",
          "‰∏ãÁáüÂçÄ",
          "Êü≥ÁáüÂçÄ",
          "ÈπΩÊ∞¥ÂçÄ",
          "ÂñÑÂåñÂçÄ",
          "Â§ßÂÖßÂçÄ",
          "Â±±‰∏äÂçÄ",
          "Êñ∞Â∏ÇÂçÄ",
          "ÂÆâÂÆöÂçÄ",
        ],
        È´òÈõÑÂ∏Ç: [
          "Êñ∞ËààÂçÄ",
          "ÂâçÈáëÂçÄ",
          "ËãìÈõÖÂçÄ",
          "ÈπΩÂüïÂçÄ",
          "ÈºìÂ±±ÂçÄ",
          "ÊóóÊ¥•ÂçÄ",
          "ÂâçÈéÆÂçÄ",
          "‰∏âÊ∞ëÂçÄ",
          "Ê•†Ê¢ìÂçÄ",
          "Â∞èÊ∏ØÂçÄ",
          "Â∑¶ÁáüÂçÄ",
          "‰ªÅÊ≠¶ÂçÄ",
          "Â§ßÁ§æÂçÄ",
          "Â≤°Â±±ÂçÄ",
          "Ë∑ØÁ´πÂçÄ",
          "ÈòøËìÆÂçÄ",
          "Áî∞ÂØÆÂçÄ",
          "ÁáïÂ∑¢ÂçÄ",
          "Ê©ãÈ†≠ÂçÄ",
          "Ê¢ìÂÆòÂçÄ",
          "ÂΩåÈôÄÂçÄ",
          "Ê∞∏ÂÆâÂçÄ",
          "ÊπñÂÖßÂçÄ",
          "È≥≥Â±±ÂçÄ",
          "Â§ßÂØÆÂçÄ",
          "ÊûóÂúíÂçÄ",
          "È≥•ÊùæÂçÄ",
          "Â§ßÊ®πÂçÄ",
          "ÊóóÂ±±ÂçÄ",
          "ÁæéÊøÉÂçÄ",
          "ÂÖ≠ÈæúÂçÄ",
          "ÂÖßÈñÄÂçÄ",
          "ÊùâÊûóÂçÄ",
          "Áî≤‰ªôÂçÄ",
          "Ê°ÉÊ∫êÂçÄ",
          "ÈÇ£Áë™Â§èÂçÄ",
          "ËåÇÊûóÂçÄ",
          "ËåÑËê£ÂçÄ",
        ],
        Â±èÊù±Á∏£: [
          "Â±èÊù±Â∏Ç",
          "ÊΩÆÂ∑ûÈéÆ",
          "Êù±Ê∏ØÈéÆ",
          "ÊÅÜÊò•ÈéÆ",
          "Ëê¨‰∏πÈÑâ",
          "Èï∑Ê≤ªÈÑâ",
          "È∫üÊ¥õÈÑâ",
          "‰πùÂ¶ÇÈÑâ",
          "ÈáåÊ∏ØÈÑâ",
          "ÈπΩÂüîÈÑâ",
          "È´òÊ®πÈÑâ",
          "Ëê¨Â∑íÈÑâ",
          "ÂÖßÂüîÈÑâ",
          "Á´πÁî∞ÈÑâ",
          "Êñ∞Âü§ÈÑâ",
          "ÊûãÂØÆÈÑâ",
          "Êñ∞ÂúíÈÑâ",
          "Â¥ÅÈ†ÇÈÑâ",
          "ÊûóÈÇäÈÑâ",
          "ÂçóÂ∑ûÈÑâ",
          "‰Ω≥ÂÜ¨ÈÑâ",
          "ÁêâÁêÉÈÑâ",
          "ËªäÂüéÈÑâ",
          "ÊªøÂ∑ûÈÑâ",
          "ÊûãÂ±±ÈÑâ",
          "‰∏âÂú∞ÈñÄÈÑâ",
          "ÈúßÂè∞ÈÑâ",
          "Áë™ÂÆ∂ÈÑâ",
          "Ê≥∞Ê≠¶ÈÑâ",
          "‰æÜÁæ©ÈÑâ",
          "Êò•Êó•ÈÑâ",
          "ÁçÖÂ≠êÈÑâ",
          "Áâ°‰∏πÈÑâ",
        ],
        Ëä±ËìÆÁ∏£: [
          "Ëä±ËìÆÂ∏Ç",
          "È≥≥ÊûóÈéÆ",
          "ÁéâÈáåÈéÆ",
          "Êñ∞ÂüéÈÑâ",
          "ÂêâÂÆâÈÑâ",
          "Â£ΩË±êÈÑâ",
          "ÂÖâÂæ©ÈÑâ",
          "Ë±êÊø±ÈÑâ",
          "ÁëûÁ©óÈÑâ",
          "Ëê¨Ê¶ÆÈÑâ",
          "ÂçìÊ∫™ÈÑâ",
          "ÁßÄÊûóÈÑâ",
        ],
        Âè∞Êù±Á∏£: [
          "Âè∞Êù±Â∏Ç",
          "ÊàêÂäüÈéÆ",
          "ÈóúÂ±±ÈéÆ",
          "ÂçëÂçóÈÑâ",
          "Â§ßÊ≠¶ÈÑâ",
          "Â§™È∫ªÈáåÈÑâ",
          "Êù±Ê≤≥ÈÑâ",
          "Èï∑Êø±ÈÑâ",
          "ÈπøÈáéÈÑâ",
          "Ê±†‰∏äÈÑâ",
          "Á∂†Â≥∂ÈÑâ",
          "Âª∂Âπ≥ÈÑâ",
          "Êµ∑Á´ØÈÑâ",
          "ÈáëÂ≥∞ÈÑâ",
          "ÈÅî‰ªÅÈÑâ",
          "Ëò≠Â∂ºÈÑâ",
        ],
        ÊæéÊπñÁ∏£: ["È¶¨ÂÖ¨Â∏Ç", "ÊπñË•øÈÑâ", "ÁôΩÊ≤ôÈÑâ", "Ë•øÂ∂ºÈÑâ", "ÊúõÂÆâÈÑâ", "‰∏ÉÁæéÈÑâ"],
        ÈáëÈñÄÁ∏£: ["ÈáëÂüéÈéÆ", "ÈáëÊπñÈéÆ", "ÈáëÊ≤ôÈéÆ", "ÈáëÂØßÈÑâ", "ÁÉàÂ∂ºÈÑâ", "ÁÉèÂùµÈÑâ"],
        ÈÄ£Ê±üÁ∏£: ["ÂçóÁ´øÈÑâ", "ÂåóÁ´øÈÑâ", "ËéíÂÖâÈÑâ", "Êù±ÂºïÈÑâ"],
      };

      const citySel = document.getElementById("city"),
        distSel = document.getElementById("district");
      Object.keys(cityDistrictData).forEach((c) => {
        let o = document.createElement("option");
        o.value = c;
        o.text = c;
        citySel.appendChild(o);
      });
      citySel.addEventListener("change", function () {
        distSel.innerHTML = '<option value="">ÈÑâÈéÆÂçÄ</option>';
        (cityDistrictData[this.value] || []).forEach((d) => {
          let o = document.createElement("option");
          o.value = d;
          o.text = d;
          distSel.appendChild(o);
        });
      });

      document
        .getElementById("profileForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const name = document.getElementById("name").value.trim();
          const year = yearSel.value;
          const month = monSel.value;
          const gender = document.querySelector(
            'input[name="gender"]:checked'
          )?.value;
          const city = citySel.value;
          const area = distSel.value;
          const height = document.getElementById("height").value;
          const weight = document.getElementById("weight").value;

          if (
            !name ||
            !year ||
            !month ||
            !gender ||
            !city ||
            !area ||
            !height ||
            !weight
          ) {
            alert("Ë´ãÂ∞áÊâÄÊúâÊ¨Ñ‰ΩçÂ°´ÂØ´ÂÆåÊï¥");
            return;
          }

          const birthdate = `${year}-${month}-01`;

          const formData = new FormData();
          formData.append("name", name);
          formData.append("gender", gender);
          formData.append("birthdate", birthdate);
          formData.append("city", city);
          formData.append("area", area);
          formData.append("height", height);
          formData.append("weight", weight);
          if (croppedBlob) {
            formData.append("avatar", croppedBlob, "avatar.png");
          }

          try {
            const res = await fetch(`/api/members/${MEMBER_ID}`, {
              method: "PUT",
              body: formData,
            });
            const data = await res.json();
            if (res.ok && data.success) {
              window.location.href = `/preference?member_id=${MEMBER_ID}`; // üëà Âä†ÂÖ•ÈÄôË°å
            } else {
              throw new Error(data.error || "Êõ¥Êñ∞Â§±Êïó");
            }
          } catch (err) {
            alert(err.message);
          }
        });
    </script>
  </body>
</html>
