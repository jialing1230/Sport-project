<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <link rel="manifest" href="/static/manifest.json" />
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/static/service-worker.js")
          .then(() => console.log("Service Worker Registered"))
          .catch((error) =>
            console.error("Service Worker Registration Failed:", error)
          );
      }
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>我的活動</title>
    <style>
      /* 讓 padding 不會把元素撐爆寬度，避免出現水平卷軸 */
      *, *::before, *::after { box-sizing: border-box; }

      :root {
        --primary-color: #64bcd0;
        --text-color: #2c4975;
        --fab-color: #fea3a8;
        --beige-color: #fdf9ed;
        --bg-color: #f5f5f5;
        --tab-bg: #ffffff;
        --word-color: black;
        --header-h: 66px;   /* tabs-container 64px + divider 2px */
        --bottom-h: 60px;   /* 你的 bottom-nav 高度 */
        --card-w: 340px;
      }
      @media (max-width: 600px){
        :root{ --card-w: 320px; }  /* 手機卡片寬 */
         .activity-card-container {
          grid-template-columns: 1fr;
          justify-items: center;      /* ← 置中 grid item */
        }
        .activity-card,
        .add-activity-card {
          width: var(--card-w);       /* 保留固定寬 */
          max-width: 100%;
          justify-self: center;       /* grid 自己也置中（保險） */
          margin: 0 auto;             /* block 置中（再保險） */
        }
      }

      html, body{
        height: 100%;
        overflow: hidden;              /* 鎖住整頁卷軸，只讓內容區滾 */
      }
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-size: 16px;
      }

      .tabs-wrapper {
        background-color: var(--tab-bg);
        position: fixed;
        top: 0; left: 0; right: 0;
        z-index: 1200;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08); /* ⭐ tabs區域增加微陰影 */
      }

      .tabs-container {
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        height: 64px; /* ⭐略提高 */
      }

      .tab {
        flex: 1;
        text-align: center;
        line-height: 64px;
        font-size: 18px;
        font-weight: bold;
        letter-spacing: 0.5px;
        color: var(--text-color);
        cursor: pointer;
        background-color: var(--tab-bg);
        border: none;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease;
      }

      /* Hover效果：微縮放 */
      .tab:hover {
        transform: scale(1.05);
      }

      /* 點擊特效 */
      .tab::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--primary-color);
        opacity: 0;
        transition: opacity 0.6s ease;
        pointer-events: none;
      }

      .tab:active::after {
        opacity: 0.4;
        transition: opacity 0.6s ease;
      }

      /* 被選中的Tab文字變水藍色 */
      .tab.active {
        color: var(--primary-color);
      }

      .divider {
        height: 2px;
        background: #e0e0e0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* ⭐微加深陰影 */
        position: relative;
        z-index: 1;
      }

      .indicator {
        position: absolute;
        top: 0;
        height: 3px;
        background-color: var(--primary-color);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        transition: left 0.3s ease, width 0.3s ease;
        z-index: 2;
        border-radius: 2px;
      }

      /* 手機：左右只留 12px */
      .tab-content {
        padding: 16px 18px;
        font-size: 24px;
        text-align: center;
        font-weight: 600;
        line-height: 1.8;
        letter-spacing: 0.5px;
      }


      /* FAB按鈕 */
      .fab {
        position: fixed;
        bottom: 60px;
        right: 30px;
        width: 60px;
        height: 60px;
        background-color: var(--fab-color);
        color: var(--beige-color);
        border: none;
        border-radius: 50%;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        font-size: 30px;
        font-weight: bold;
        text-align: center;
        line-height: 60px;
        cursor: pointer;
        transition: background-color 0.3s, opacity 0.3s ease,
          transform 0.2s ease;
        opacity: 1;
        z-index: 1100;
      }

      .fab.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .fab:hover {
        background-color: #f98d92;
        transform: scale(1.08); /* ⭐hover時微放大 */
      }

      .fab:active {
        transform: scale(0.95); /* ⭐點擊時微縮小 */
      }

      /* 手機：卡片撐滿欄寬、不再有額外左右留白 */
      .activity-card-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        justify-content: center;
        justify-items: stretch;   /* <- 關鍵：撐滿 */
        padding: 0;               /* <- 避免和 .tab-content 雙重 padding */
        margin: 0 auto;
        width: 100%;
      }

      .activity-card {
        background-color: #fff;
        border-radius: 8px;
        overflow: hidden;
        /* 初始陰影保持輕一些 */
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        width:  var(--card-w);
       
        padding: 20px;
        font-size: 16px;
        color: var(--text-color);
        /* 只做陰影的過渡 */
        transition: box-shadow 0.25s ease;
        position: relative;
        box-sizing: border-box;
        min-height: 220px;
        height: auto;         /* ← 避免被拉到跟整列一樣高 */
      }


      .label {
        color: var(--text-color);
        font-weight: bold;
      }

      .value {
        color: var(--word-color); /* 黑色 */
        font-weight: normal;
      }

      .status-text {
        font-weight: normal;
        color: black; /* 深藍色，與主題一致 */
        margin-right: 10px; /* 與按鈕保持間距 */
      }

      .activity-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* ⭐ 輕微加深陰影 */
      }


      .activity-card h3 {
        font-size: 24px;
        color: var(--primary-color);
      }

      .activity-card p {
        margin: 0px 0px;
        line-height: 1.5;
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 20px;
        z-index: 1300;
        overflow: visible;
      }

      .modal-content {
        position: relative; /* 確保子元素的絕對定位基於此容器 */
        background-color: #fff;
        padding: 15px;
        border-radius: 8px;
        width: 80%; /* 使用百分比寬度 */
        max-width: 400px; /* 設置最大寬度 */
        height: auto; /* 高度自適應內容 */
        max-height: 90%; /* 設置最大高度 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        text-align: left;
        overflow: visible; /* 防止內容溢出 */
      }

      .modal-content .scrollable-content {
        max-height: 80%; /* 限制滾動區域的高度 */
        overflow-y: auto; /* 僅在此區域啟用垂直滾動 */
      }

      .modal-content h2 {
        margin-top: 0;
        color: var(--primary-color);
        text-align: center;
      }
      @media (max-width: 768px) {
        .modal-content {
          padding: 15px; /* 減少內邊距 */
          border-radius: 8px; /* 調整圓角 */
        }

        .modal-content h2 {
          font-size: 18px; /* 縮小標題字體 */
        }

        .participant-card {
          font-size: 14px; /* 縮小參加者卡片字體 */
          padding: 8px 10px; /* 減少內邊距 */
        }

        .participant-avatar {
          width: 30px; /* 縮小頭像大小 */
          height: 30px;
        }

        .participants-list {
          max-height: 150px; /* 限制列表高度 */
        }
      }

      /* 針對更小的螢幕進行進一步優化 */
      @media (max-width: 480px) {
        .modal-content {
          padding: 10px; /* 進一步減少內邊距 */
        }

        .modal-content h2 {
          font-size: 16px; /* 再次縮小標題字體 */
        }

        .participant-card {
          font-size: 12px; /* 再次縮小參加者卡片字體 */
          padding: 5px 8px; /* 減少內邊距 */
        }

        .participant-avatar {
          width: 25px; /* 再次縮小頭像大小 */
          height: 25px;
        }

        .participants-list {
          max-height: 120px; /* 進一步限制列表高度 */
        }
      }

      .close {
        position: absolute;
        top: -15px; /* 將按鈕移到卡片外 */
        right: -30px; /* 將按鈕移到卡片外 */
        font-size: 32px; /* 放大按鈕 */
        cursor: pointer;
        background-color: #fff; /* 添加背景色，讓按鈕更明顯 */
        border: 2px solid var(--primary-color); /* 添加邊框 */
        border-radius: 50%; /* 圓形按鈕 */
        width: 40px; /* 設定寬度 */
        height: 40px; /* 設定高度 */
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 添加陰影 */
        transition: transform 0.2s ease, background-color 0.2s ease; /* 添加過渡效果 */
        z-index: 100;
      }

      .close:hover {
        transform: scale(1.2); /* 滑鼠懸停時放大 */
        background-color: #ff6b6b; /* 改變背景色 */
        border-color: #ff6b6b !important;
        color: #fff; /* 改變文字顏色 */
      }

      .close-button {
        position: absolute; /* 絕對定位，基於父容器 .modal-content */
        bottom: 20px; /* 距離模態框底部 20px */
        left: 20px; /* 距離模態框左側 20px */
        padding: 10px 20px;
        background-color: var(--primary-color);
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.2s ease;
      }

      .close-button:hover {
        background-color: #4aa3b5;
      }
      .modal-tabs {
        display: flex;
        justify-content: center;
        position: relative;
        background-color: var(--tab-bg);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }

      .modal-tab {
        flex: 1;
        text-align: center;
        line-height: 50px;
        font-size: 18px;
        font-weight: bold;
        color: var(--text-color);
        cursor: pointer;
        background-color: var(--tab-bg);
        border: none;
        position: relative;
        transition: transform 0.2s ease, color 0.2s ease;
      }

      .modal-tab:hover {
        transform: scale(1.05);
      }

      .modal-tab.active {
        color: var(--primary-color);
      }

      .modal-divider {
        height: 2px;
        background: #e0e0e0;
        position: relative;
      }

      .modal-indicator {
        position: absolute;
        top: 0;
        height: 3px;
        background-color: var(--primary-color);
        transition: left 0.3s ease, width 0.3s ease;
        border-radius: 2px;
      }

      .modal-tab-content {
        display: none;
        padding: 20px;
        font-size: 16px;
        color: var(--text-color);
      }

      .modal-tab-content.active {
        display: block;
      }

      .modal-tab-content h3 {
        margin-top: 5px; /* 調整上方間距，讓標題更靠上 */
        margin-bottom: 10px; /* 調整下方間距 */
        font-size: 18px; /* 確保字體大小適中 */
        color: #2c4975; /* 深藍色，與主題一致 */
        font-weight: bold; /* 加粗字體，讓標題更突出 */
      }

      .participants-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 5px;
      }

      .participant-card {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-size: 16px;
        color: var(--text-color);
      }

      .participant-card.organizer {
        background-color: #e8f5e9;
        font-weight: bold;
      }

      .participant-card span {
        margin-left: 10px;
        color: var(--primary-color);
      }

      .participant-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px;
      }

      .participant-card img {
        margin-right: 10px;
      }

      .participants-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 200px; /* 限制高度 */
        overflow-y: auto; /* 滾動條 */
        padding-right: 10px; /* 增加內邊距，避免滾動條遮住內容 */
      }

      .participants-list::-webkit-scrollbar {
        width: 8px; /* 滾動條寬度 */
      }

      .participants-list::-webkit-scrollbar-thumb {
        background-color: var(--primary-color); /* 滾動條顏色 */
        border-radius: 4px; /* 圓角 */
      }

      .participants-list::-webkit-scrollbar-track {
        background-color: #f0f0f0; /* 滾動條背景 */
      }

      #evaluateModal .modal-content {
        width: 400px;
        height: auto;
        padding: 20px;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        text-align: center;
      }

      #evaluateModal textarea {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        font-size: 16px;
      }

      #evaluateModal .submit-button {
        padding: 10px 20px;
        background-color: var(--primary-color);
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      #evaluateModal .submit-button:hover {
        background-color: #4aa3b5;
      }

      .status-text {
        font-weight: normal;
        color: black; /* 深藍色，與主題一致 */
        margin-right: 10px; /* 與按鈕保持間距 */
      }


      .evaluate-button {
        display: inline-flex;
        align-items: center;
        background: none; /* 移除背景 */
        border: none; /* 移除邊框 */
        padding: 0; /* 移除內邊距 */
        cursor: pointer;
      }

      .evaluate-icon {
        width: 24px; /* 圖標寬度 */
        height: 24px; /* 圖標高度 */
        transition: transform 0.2s ease;
      }

      .evaluate-button:hover .evaluate-icon {
        transform: scale(1.2); /* 滑鼠懸停時放大 */
      }
      .bottom-bar-button {
        background: none;
        border: none;
        padding: 5px 0;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .bottom-bar-label {
        font-size: 12px;
        color: #2c4975;
        margin-top: 4px;
      }
      button[onclick^="cancelParticipation"] {
        width: 10px; /* 增加按鈕寬度 */
        height: 10px; /* 增加按鈕高度 */
        background: none;
        border: none;
        cursor: pointer;
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      button[onclick^="cancelParticipation"] img {
        width: 100%; /* 圖標填滿按鈕 */
        height: 100%;
        transition: transform 0.2s ease; /* 添加平滑過渡效果 */
      }

      button[onclick^="cancelParticipation"]:hover img {
        transform: scale(1.2); /* 滑鼠懸停時放大 */
      }

      .action-button {
        background: none; /* 移除按鈕背景 */
        border: none; /* 移除按鈕邊框 */
        padding: 0; /* 移除內邊距 */
        cursor: pointer; /* 設置為可點擊 */
      }

      .action-button img {
        width: 24px; /* 設定圖片大小 */
        height: 24px;
        border-radius: 50%; /* 確保圖片為圓形 */
        transition: transform 0.2s ease; /* 添加平滑過渡效果 */
      }

      .action-button img:hover {
        transform: scale(1.2); /* 滑鼠懸停時放大 */
      }

      .action-button img:active {
        transform: scale(0.9); /* 按下時縮小 */
      }
      .bottom-nav {
        display: flex;
        justify-content: space-around;
        align-items: center;
        height: 60px;
        background-color: #fff;
        border-top: 1px solid #ccc;
        position: fixed;      /* ✅ 改成固定定位 */
        bottom: 0;            /* ✅ 貼齊畫面底部 */
        left: 0;
        right: 0;
        z-index: 1000;        /* ✅ 確保浮在最上層 */
        box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
      }

      .bottom-item {
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        text-decoration: none;
        transition: transform 0.2s ease;
        z-index: 1;
        border: none;         /* ✅ 移除邊框 */
        outline: none;        /* ✅ 移除點擊時的外框 */
        background-color: #ffffff;
      }

      .bottom-item svg {
        fill: #2c4975;
        transition: fill 0.3s ease, transform 0.3s ease;
        width: 26px;
        height: 28px;
        position: relative;
      }

      .bottom-item.active svg {
        fill: #64bcd0;
        transform: translateY(0px);
      }

      .item-label {
        font-size: 12px;
        color: #2c4975;
        height: 0;
        overflow: hidden;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .bottom-item.active .item-label {
        height: 16px;
        opacity: 1;
        margin-top: 0px;
        color: #64bcd0;
      }

      .ripple {
        position: absolute;
        border-radius: 50%;
        background-color: rgba(129, 211, 225, 0.35);
        transform: scale(0);
        animation: ripple-animation 0.9s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
        z-index: 0;
      }

      @keyframes ripple-animation {
        to {
          transform: scale(2.5);
          opacity: 0;
        }
      }
      /* 中間內容區：用整個視窗剩餘高度，自己滾動 */
      #tabContents{
        position: fixed;
        top: var(--header-h);
        left: 0; right: 0;
        bottom: var(--bottom-h);
        overflow: auto;
        -webkit-overflow-scrolling: touch;  /* iOS 慣性滾動 */
        background: var(--bg-color);
        /* 如果你有左右內距控制，留著原本的 .tab-content 規則即可 */
      }
      /* iPhone 瀏海安全區（可選） */
      @supports(padding:max(0px)){
        #tabContents{ bottom: calc(var(--bottom-h) + env(safe-area-inset-bottom)); }
        .bottom-nav{ padding-bottom: env(safe-area-inset-bottom); }
      }
      #activityTypeModal {
        display: none;
        position: fixed;
        z-index: 1200;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: flex-end; /* 改為底部對齊 */
        transition: background-color 0.3s ease;
      }

      #activityTypeModal.show {
        display: flex;
      }

      .activity-type-box {
        background-color: #fff;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        padding: 24px 16px;
        width: 100%;
        max-width: 420px;
        text-align: center;
        position: relative;
        box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.2);
        transform: translateY(100%);
        animation: slideUp 0.3s ease-out forwards;
      }
      .activity-type-box::after {
        content: "";
        position: absolute;
        bottom: -20px;   /* ⬅️ 延伸一塊白色到下方 */
        left: 0;
        right: 0;
        height: 20px;
        background: #fff;
      }

      @supports(padding:max(0px)){
        .activity-type-box {
          bottom: calc(16px + env(safe-area-inset-bottom));
        }
      }

      @keyframes slideUp {
        to {
          transform: translateY(0%);
        }
      }

      .activity-type-title {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 24px;
        font-size: 18px;
        font-weight: bold;
        color: var(--text-color);
      }

      .activity-type-title svg {
        margin-left: 6px;
        width: 18px;
        height: 18px;
        stroke: var(--primary-color);
        stroke-width: 2;
      }

      .activity-type-options {
        display: flex;
        gap: 32px;
        justify-content: center;
      }

      .activity-type-btn {
        border: none;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        padding: 16px;
        width: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: none;
        cursor: pointer;
        position: relative;
        font-weight: 600;
      }

      .activity-type-btn:hover {
        transform: none;
      }

      .activity-type-btn svg {
        width: 36px;
        height: 36px;
        stroke: var(--text-color);
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
        display: block;
      }

      .activity-type-btn div {
        color: var(--text-color);
        font-weight: bold;
      }
      /* 鎖定狀態：把卡片內容淡化＋去色（膠囊不受影響） */
      .activity-type-btn.is-locked > :not(.lock-pill){
        opacity: .55;
        filter: grayscale(1);
      }


      /* 付費膠囊（只保留這一份） */
      .activity-type-btn .lock-pill{
        position: absolute;
        top: 36px;
        left: 12px;
        font-size: 12px;
        color: #2c4975;
        background: #fff;
        border: 1px solid rgba(44,73,117,.15);
        border-radius: 999px;
        padding: 3px 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,.08);
        pointer-events: none;        /* 不阻擋點擊 */
        white-space: nowrap;
        z-index: 3;
        transition: background-color .2s ease, color .2s ease, border-color .2s ease;
      }
      /* 未開通：滑過卡片時，只有膠囊反轉顏色 */
      .activity-type-btn.is-locked:hover .lock-pill,
      .activity-type-btn.is-locked:focus-visible .lock-pill,
      .activity-type-btn.is-locked:active .lock-pill{
        background: #2c4975;
        color: #fff;
        border-color: #2c4975;
      }
      .custom-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: -8px;
        margin-bottom: 6px;
      }
      .custom-card-title {
        font-size: 28px !important;
        font-weight: bold;
        color: #2c4975 !important;
        margin: 0;
      }
      .status-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: bold;
        letter-spacing: 1px;
        padding: 7px 10px 4px 10px;   /* ↑ top 多一點 ↓ bottom 少一點 */
        border-radius: 8px;
        color: white;
        background-color: #fda7a8;
        line-height: 1;
        min-width: 60px;
      
      }
      .custom-card-info {
        color: #2c4975;
        margin: 4px 0 8px;
        text-align: left;
        margin-top: -10px !important;
        padding-bottom: 6px;
        font-weight: normal; 
        border-bottom: 1px solid #64bcd0;
        width: 100%; /* 確保橫線能展開整個區塊 */
        display: block; /* 確保樣式可被渲染 */
         margin-bottom: 15px !important;
        
        
        
      }
      .custom-card-icon-line {
         font-weight: normal; 
         display: flex;
         align-items: center;       /* ✅ 圖示與文字垂直置中 */
         gap: 6px;                  /* ✅ 圖示與文字間距 */
         margin: 4px 0;
         justify-content: flex-start; /* ✅ 內容靠左對齊 */
         margin-top: 10px !important;
      }
      /* 單行省略號 */
      .truncate-1 {
        flex: 1;           /* 讓它撐滿剩餘空間 */
        min-width: 0;      /* ✅ 關鍵，沒有這個 ellipsis 不會生效 */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
      }
      /* 活動類型樣式：共用設定 */
      .activity-type {
        font-size: 13px;
        margin-left: 8px;
        vertical-align: middle;
      }

      /* 如果是訓練課程：加底框 */
      .activity-type.training {
        background-color: #2c4975;
        color: white;
        font-weight: bold;
        border-radius: 10px;
        padding: 4px 10px;
        display: inline-block;
      }

      /* 如果是一般活動：只有文字 */
      .activity-type.general {
        color: #2c4975;
        font-weight: normal;
        padding: 0;
        background: none;
      }
      @media (min-width: 768px) {
        .tab-content { padding: 20px 16px; }
        .activity-card-container { gap: 24px; }
      }

    /* 桌機：卡片固定寬 340px，能放幾張就放幾張，自動換行，不拉伸 */
    @media (min-width: 1024px) {
      .tab-content {
        max-width: min(1600px, 100% - 64px);
        margin: 0 auto;
        padding: 20px 0;
      }

      .activity-card-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(var(--card-w), var(--card-w)));
        /* ↑ 每欄寬就是卡片寬，瀏覽器自動計算能擺幾欄；不夠就換行 */
        gap: 32px;
        justify-content: center; /* 整排置中（左右會留均等空白） */
        justify-items: center;   /* 每張卡在欄內置中 */
      }

      .activity-card,
      .add-activity-card {
        width: var(--card-w);     /* 固定寬 */
        max-width: var(--card-w); /* 不被撐大 */
        /* 不要再寫 width:100% / max-width:none */
      }
    }

      /* ⭐ 1440px 以上顯示四欄（340px 卡片 + 20px 間距剛好） */
      @media (min-width: 1440px) {
        .activity-card-container {
          grid-template-columns: repeat(4, 1fr);
          max-width: 1600px;      /* 4*340 + 3*20 = 1420，讓整排置中好看 */
          margin: 0 auto;         /* 置中容器 */
        }

      }
      /* 讓新增卡片與活動卡片同框架 */
      .add-activity-card {
        border: 2px dashed var(--primary-color);
        background-color: transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 220px;    /* 跟一般卡片一致 */
        box-shadow: none;     /* 拿掉陰影 */
        cursor: pointer;
        height: auto;      /* ← 由內容決定高度 */
        align-self: start; /* ← 即使整列很高，＋卡片自己維持正常高度 */
      }

      /* ＋符號樣式 */
      .add-activity-card .plus-sign {
        font-size: 48px;
        font-weight: bold;
        color: var(--primary-color);
        line-height: 1;
      }
      /* 平板：601–1023px，兩欄置中 */
      @media (min-width: 601px) and (max-width: 1023px) {
        .activity-card-container {
          grid-template-columns: repeat(2, minmax(0, 1fr)); /* 兩欄 */
          gap: 24px;                  /* 卡片間距，可調整 */
          justify-items: center;      /* 每個 item 在格子內置中 */
        }

        .activity-card,
        .add-activity-card {
          width: var(--card-w);       /* 固定寬度（340px） */
          max-width: 100%;
          justify-self: center;       /* grid 自己也置中 */
          margin: 0 auto;             /* 再保險 */
        }
      }
      .custom-card-icon-line span {
        white-space: nowrap;
        overflow-x: auto;
        display: inline-block;
      }
      /* 讓價格區塊恢復為 flex 並改成上下排 */
      .custom-card-icon-line .price-and-tag { 
        display: flex; 
        align-items: center; 
        gap: 12px; 
      }

      .custom-card-icon-line .price-wrapper {
        display: flex !important;
        flex-direction: column;
        align-items: flex-start;
        line-height: 1.2;
        white-space: normal !important; /* 不要被上面那條 nowrap 影響 */
        overflow: visible !important;   /* 不要出現橫向捲軸 */
      }

      /* 價格內的兩行各自成一行 */
      .custom-card-icon-line .price-wrapper .original-price,
      .custom-card-icon-line .price-wrapper .discount-price {
        display: block;
      }

      /* 訓練課程 */
      .custom-card-tag.training {
        background-color: #2c4975;
        color: #fff;
        
        border-radius: 0px;
        padding:3px 10px 1px 10px;
        display: inline-block;
      }

      /* 一般活動：維持原本樣式 */
      .custom-card-tag.general {
        color: #2c4975;
        background: transparent;
      }
      /* 讓卡片能放膠囊 */
      .activity-type-btn { position: relative; }


      /* 有些 SVG 用 currentColor，強制給顏色 */
      .activity-type-btn{ color: var(--text-color); }
      .activity-type-btn svg path,
      .activity-type-btn svg rect,
      .activity-type-btn svg circle,
      .activity-type-btn svg polygon {
        fill: var(--text-color);   /* 若你想沿用深藍就用這個 */
        /* 或想固定色：fill:#2c4975; */
      }
      /* 只針對升級提示這個 modal：置中、層級更高 */
      #upgradeModal{
        z-index: 1400;        /* 一定蓋過 #activityTypeModal(1200) */
        align-items: center;  /* 垂直置中 */
      }

      /* 升級提示的白卡片 */
      #upgradeModal .modal-content{
        width: 300px;
        max-width: calc(100% - 48px);
        padding: 1px 16px 16px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 8px 24px rgba(0,0,0,.2);
      }

      /* 升級提示不要右上角叉叉 */
      #upgradeModal .close{ display:none; }

      /* 對話框版型（之後別的彈窗也能重用） */
      .dialog-title{
        margin-bottom: 16px;
        font-size: 20px;
        font-weight: bold;
        color: #2c4975;
        letter-spacing: .5px;
      }
      .dialog-desc{
        margin: 8px 0 18px;
        font-size: 14px;
        color: #000;
        line-height: 1.7;
        font-weight: 300;  /* ← 改細字 */
      }
      .dialog-actions{
        display:flex;
        justify-content:center;
        gap: 40px;
      }
      .btn{
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 700;
        border: 2px solid transparent;
        cursor: pointer;
        transition: transform .18s ease, filter .28s ease, box-shadow .35s ease;
      }
      .btn:active{ transform: scale(.98); }
      .btn-outline-pink{
        background: #fff;
        color: var(--fab-color);
        border-color: var(--fab-color);
      }

      .btn-pink{
        background: var(--fab-color);
        color: #fff;
      }
      .btn-pink:hover{ filter: brightness(.95); }

      /* 保險：鎖定時，不要有放大或變色（卡片保持原樣） */
      .activity-type-btn.is-locked:hover,
      .activity-type-btn.is-locked:active{
        transform: none;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }
      /* hover 時才出現陰影 */
      .btn-outline-pink:hover,
      .btn-pink:hover {
        box-shadow: 0 3px 8px rgba(0,0,0,0.12);
        transform: translateY(-1px); /* 可選：稍微浮起 */
      }
      /* 只針對 活動類型說明 的彈窗做新樣式 */
      #typeInfoModal{
        display: none;             /* 預設隱藏（用 JS 顯示） */
        align-items: center !important;   /* 垂直置中 */
        justify-content: center !important; /* 水平置中 */
        padding-top: 0 !important; /* 拿掉上方 padding */
        z-index: 1350;             /* 比底部抽屜更上層一點（看你需求可調） */
      }

      /* 卡片樣式（與 upgrade 分開） */
      #typeInfoModal .modal-content{
        width: 320px;
        max-width: calc(100% - 48px);
        padding: 16px 16px 64px;  /* 底部多留空間放關閉按鈕 */
        border-radius: 10px;
        text-align: left;
        position: relative;       /* 讓關閉鈕可以絕對定位到底部置中 */
        box-shadow: 0 8px 24px rgba(0,0,0,.18);
      }

      /* 不要右上角叉叉 */
      #typeInfoModal .close{ display:none !important; }

      /* 內容滾動高度（避免被底部關閉鈕遮住） */
      #typeInfoModal .scrollable-content{
        max-height: 50vh;
        overflow-y: auto;
        padding-right: 4px;
      }

      /* 底部關閉按鈕 */
      #typeInfoModal .modal-close-btn{
        position: absolute;
        left: 50%;
        bottom: 14px;
        transform: translateX(-50%);
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        background: var(--primary-color);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
        transition: transform .18s ease, box-shadow .35s ease, filter .28s ease;
      }
      #typeInfoBtn {
        cursor: pointer;
      }

      /* 活動類型說明 Modal：標題、內文、標籤統一排版 */
      #typeInfoModal h2 {
        text-align: center;
        margin: 8px 0 2px;
        font-size: 18px;
        font-weight: 700;
        color: var(--text-color); /* 水藍色標題 */
      }

      #typeInfoModal h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary-color); /* 深藍 */
        margin: 10px 0 6px;
      }

      #typeInfoModal .info-tag {
        font-size: 12px;
        color: #4aa3b5;   /* 淺藍提示 */
        font-weight: normal;
      }

      #typeInfoModal ul {
        margin: 0 0 6px 20px; /* 左邊縮進 */
        padding: 0;
        color: #2c4975;
        line-height: 1.7;
      }

      #typeInfoModal li {
        margin-bottom: 4px;
        font-size: 14px;
      }

      /* 關閉按鈕 */
      #typeInfoModal .modal-close-btn {
        display: block;
        margin: 10px auto;  /* 置中 */
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        background:#81d3e1;
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }

      #typeInfoModal .modal-close-btn:hover {
        background: #2c4975; 
      }
      #typeInfoModal .scrollable-content {
        padding-left: 18px;  /* 左邊加 12px */
      }
      /* 右上角「優惠」折角 */
      .discount-corner {
        position: absolute;
        right: 0;
        bottom: 0;
        width: 0;
        height: 0;
        border-left: 50px solid transparent;   /* 左邊透明 */
        border-bottom: 50px solid #ddd;     /* 下邊紅色折角 */
        z-index: 2;
        
        
      }

      .discount-corner__icon{
        position: absolute;
        right: 6px;        /* 往右貼一點 */
        bottom: -45px;     /* 因為是下邊三角，Y 需要是負值讓圖示落在三角裡 */
        width: 20px;
        height: 20px;
        display: block;
        pointer-events: none;
        /* 如果不是描邊路徑而是填色圖，可用 fill: #fff; */
      }
      .price-and-tag {
        display: flex;
        align-items: center;   /* 垂直置中，讓價格和標籤排齊 */
        gap: 12px;             /* 價格和標籤的間距 */
      }

      .price-wrapper {
        display: flex;
        flex-direction: column;  /* 👈 垂直排列：原價在上，優惠價在下 */
        align-items: flex-start; /* 靠左對齊 */
        line-height: 1.2;
      }

      .original-price {
        text-decoration: line-through;
        color: #999;
        font-size: 14px;
      }

      .discount-price {
        font-weight: bold;
        color: #fe8a90;
        font-size: 16px;
      }






    </style>
  </head>

  <body>
    <div class="tabs-wrapper">
      <div class="tabs-container" id="tabs">
        <div class="tab active" onclick="switchTab(0)">我發起的活動</div>
        <div class="tab" onclick="switchTab(1)">我參加的活動</div>
      </div>
      <div class="divider">
        <div id="indicator" class="indicator" style="width: 50%; left: 0"></div>
      </div>
    </div>

    <div id="tabContents">
      <div class="tab-content" id="content-0">
        <div id="my-activities">載入中...</div>
      </div>
      <div class="tab-content" id="content-1" style="display: none">
        尚未參加任何活動
      </div>
    </div>


    <!-- 新增活動卡片樣式的按鈕 -->

    <div class="bottom-nav">
      <!-- 地圖 -->
      <button class="bottom-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" fill="#000000" viewBox="0 0 256 256">
            <path d="M108,80a20,20,0,1,1,20,20A20,20,0,0,1,108,80ZM60,80a68,68,0,0,1,136,0c0,62.25-59.51,97-62.05,98.42a12,12,0,0,1-11.9,0C119.51,177,60,142.25,60,80Zm24,0c0,38.2,30.71,64.2,44,73.64C141.21,144.15,172,118,172,80a44,44,0,0,0-88,0Zm124.57,65.6a12,12,0,1,0-9.14,22.19C213.56,173.61,220,180.27,220,184c0,4-7.13,11.07-22.77,17.08-18.3,7-42.89,10.92-69.23,10.92s-50.93-3.88-69.23-10.92C43.12,195.07,36,188,36,184c0-3.73,6.44-10.39,20.57-16.21a12,12,0,1,0-9.14-22.19C31.27,152.25,12,164.31,12,184c0,34.14,58.36,52,116,52,29.22,0,56.86-4.44,77.85-12.52C220.1,218,244,205.59,244,184,244,164.31,224.73,152.25,208.57,145.6Z"></path>
        </svg>
        <div class="item-label">地圖</div>
      </button>

      <!-- 活動 -->
      <button class="bottom-item active">
        <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" fill="#000000" viewBox="0 0 256 256">
            <path d="M208,28H188V24a12,12,0,0,0-24,0v4H92V24a12,12,0,0,0-24,0v4H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM68,52a12,12,0,0,0,24,0h72a12,12,0,0,0,24,0h16V76H52V52ZM52,204V100H204V204Zm92-76a16,16,0,1,1-16-16A16,16,0,0,1,144,128Zm48,0a16,16,0,1,1-16-16A16,16,0,0,1,192,128ZM96,176a16,16,0,1,1-16-16A16,16,0,0,1,96,176Zm48,0a16,16,0,1,1-16-16A16,16,0,0,1,144,176Zm48,0a16,16,0,1,1-16-16A16,16,0,0,1,192,176Z"></path>
        </svg>
        <div class="item-label">活動</div>
      </button>

      <!-- ✅ 通知） -->
      <button class="bottom-item" id="notificationBtn" style="position:relative;">
        <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" fill="#000000" viewBox="0 0 256 256"><path d="M225.29,165.93C216.61,151,212,129.57,212,104a84,84,0,0,0-168,0c0,25.58-4.59,47-13.27,61.93A20.08,20.08,0,0,0,30.66,186,19.77,19.77,0,0,0,48,196H84.18a44,44,0,0,0,87.64,0H208a19.77,19.77,0,0,0,17.31-10A20.08,20.08,0,0,0,225.29,165.93ZM128,212a20,20,0,0,1-19.6-16h39.2A20,20,0,0,1,128,212ZM54.66,172C63.51,154,68,131.14,68,104a60,60,0,0,1,120,0c0,27.13,4.48,50,13.33,68Z"></path></svg>
        <span id="notificationDot" style="display:none;position:absolute;top:8px;right:28px;width:12px;height:12px;background:#e74c3c;border-radius:50%;z-index:2;"></span>
        <div class="item-label">通知</div>
      </button>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      function checkUnreadNotifications() {
        if (!memberId) return;
        fetch(`/api/members/${memberId}/notifications`)
          .then(res => res.json())
          .then(data => {
            const hasUnread = data.some(n => n.is_read === false);
            document.getElementById('notificationDot').style.display = hasUnread ? 'block' : 'none';
          });
      }
      checkUnreadNotifications();
      setInterval(checkUnreadNotifications, 60000);
    });
    </script>

      <!-- 個人 -->
      <button class="bottom-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" fill="#000000" viewBox="0 0 256 256">
            <path d="M234.38,210a123.36,123.36,0,0,0-60.78-53.23,76,76,0,1,0-91.2,0A123.36,123.36,0,0,0,21.62,210a12,12,0,1,0,20.77,12c18.12-31.32,50.12-50,85.61-50s67.49,18.69,85.61,50a12,12,0,0,0,20.77-12ZM76,96a52,52,0,1,1,52,52A52.06,52.06,0,0,1,76,96Z"></path>
        </svg>
        <div class="item-label">個人</div>
      </button>
    </div>

      <!-- 活動類型選擇彈窗 -->
    <div id="activityTypeModal" class="activity-type-modal">
      <div class="activity-type-box">
        <div class="activity-type-title">
          選擇活動類型
          <!-- 問號 SVG -->
         <svg id="typeInfoBtn" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#4aa3b5" viewBox="0 0 256 256" style="position: relative; top: 3px;">
          <path d="M144,180a16,16,0,1,1-16-16A16,16,0,0,1,144,180Zm92-52A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128ZM128,64c-24.26,0-44,17.94-44,40v4a12,12,0,0,0,24,0v-4c0-8.82,9-16,20-16s20,7.18,20,16-9,16-20,16a12,12,0,0,0-12,12v8a12,12,0,0,0,23.73,2.56C158.31,137.88,172,122.37,172,104,172,81.94,152.26,64,128,64Z"/>
        </svg>
        </div>

        <div class="activity-type-options">
          <!-- 一般活動 -->
          <button class="activity-type-btn" onclick="goToCreateWithType('general')">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="#2c4975" viewBox="0 0 256 256">
              <path d="M253.88,108.11l-25.53-51a20,20,0,0,0-26.83-9L178.34,59.7,131.7,44.58a12.14,12.14,0,0,0-7.4,0L77.66,59.7,54.48,48.11a20,20,0,0,0-26.83,9L2.12,108.11a20,20,0,0,0,9,26.83l26.67,13.34,51.18,37.41A12.15,12.15,0,0,0,93,187.62l62,16a12.27,12.27,0,0,0,3,.38,12,12,0,0,0,8.48-3.52l52.62-52.62,25.83-12.92a20,20,0,0,0,8.95-26.83Zm-58.12,29.15-27.52-26a12,12,0,0,0-16.76.26c-9.66,9.74-25.06,16.81-40.81,9.55l38.19-37h22.72l25.81,51.63ZM47.32,71.37,60.59,78l-22,43.9-13.27-6.63Zm107,107.3L101.23,165l-42-30.66L85.17,82.5,128,68.61l1.69.55L90,107.68l-.13.12a20,20,0,0,0,3.4,31c20.95,13.39,46,12.07,66.33-2.73l19.2,18.15Zm63-56.77-22-43.9,13.27-6.63,21.95,43.9ZM118.55,219a12,12,0,0,1-14.62,8.62l-26.6-6.87a12,12,0,0,1-4.08-1.93L48.92,201a12,12,0,0,1,14.16-19.37l22.47,16.42,24.38,6.29A12,12,0,0,1,118.55,219Z"/>
            </svg>

            <div>一般活動</div>
          </button>

          <!-- 訓練課程 -->
          <button class="activity-type-btn" data-type="course" onclick="goToCreateWithType('course')">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 256 256">
              <path d="M172,164a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h64A12,12,0,0,1,172,164Zm-12-52H96a12,12,0,0,0,0,24h64a12,12,0,0,0,0-24Zm60-64V216a20,20,0,0,1-20,20H56a20,20,0,0,1-20-20V48A20,20,0,0,1,56,28H90.53a51.88,51.88,0,0,1,74.94,0H200A20,20,0,0,1,220,48ZM100.29,60h55.42a28,28,0,0,0-55.42,0ZM196,52H178.59A52.13,52.13,0,0,1,180,64v8a12,12,0,0,1-12,12H88A12,12,0,0,1,76,72V64a52.13,52.13,0,0,1,1.41-12H60V212H196Z"/>
            </svg>
            <div>訓練課程</div>
          </button>

        </div>
      </div>
    </div>
      <!-- 說明彈窗 -->
      <div id="typeInfoModal" class="modal" style="display:none;">
        <div class="modal-content">
          <h2>活動類型說明</h2>
          <div class="scrollable-content">
            <h3>一般活動</h3>
            <ul>
              <li>免費建立，適合臨時揪團或單次活動</li>
              <li>快速發佈、簡易報名</li>
            </ul>
            <h3>訓練課程 <span class="info-tag">（付費會員限定）</span></h3>
            <ul>
              <li>支援單堂 / 多堂排程</li>
              <li>完整課程管理</li>
            </ul>
          </div>
          <button class="modal-close-btn" onclick="closeTypeInfo()">關閉</button>

        </div>
      </div>
      <div id="upgradeModal" class="modal" style="display:none;">
        <div class="modal-content">
          <h3 class="dialog-title">解鎖訓練課程</h3>
          <p class="dialog-desc">
            解鎖為付費發起人，即可建立訓練課程
          </p>
          <div class="dialog-actions">
            <button class="btn btn-outline-pink" onclick="closeUpgrade()">取　　消</button>
            <button class="btn btn-pink" onclick="goToMembership()">立即開通</button>
          </div>
        </div>
      </div>


    <script>
      let isPaidMember = false;

      const urlParams = new URLSearchParams(window.location.search);
      const memberId = urlParams.get("member_id");
      function twWeekday(d){ return ['日','一','二','三','四','五','六'][d.getDay()]; }
      function pad2(n){ return String(n).padStart(2,'0'); }

      function switchTab(index) {
        const tabs = document.querySelectorAll(".tab");
        const contents = document.querySelectorAll(".tab-content");
        const indicator = document.getElementById("indicator");

        tabs.forEach((tab, i) => {
          tab.classList.toggle("active", i === index);
        });

        contents.forEach((content, i) => {
          content.style.display = i === index ? "block" : "none";
        });

        const tabWidth = tabs[0].offsetWidth;
        indicator.style.width = tabWidth + "px";
        indicator.style.left = tabWidth * index + "px";
      }

      function goToCreate() {
        if (!memberId) {
          alert("無效的會員資訊！");
          return;
        }
        window.location.href = `/create_activity?member_id=${memberId}`;
      }

      function goToPage() {
        window.location.href = `/home?member_id=${memberId}`;
      }
      function goToActivity() {
        window.location.href = `/activity?member_id=${memberId}`;
      }


      function goToProfile() {
        window.location.href = `/member_view?member_id=${memberId}`;
      }

      function goToNews() {
        window.location.href = `/notice?member_id=${memberId}`;
      }


      window.addEventListener("resize", () => {
        const tabs = document.querySelectorAll(".tab");
        const activeIndex = [...tabs].findIndex((tab) =>
          tab.classList.contains("active")
        );
        const indicator = document.getElementById("indicator");
        const tabWidth = tabs[0].offsetWidth;
        indicator.style.width = tabWidth + "px";
        indicator.style.left = tabWidth * activeIndex + "px";
      });

      async function loadMyActivities() {
        if (!memberId) {
          document.getElementById("my-activities").innerText = "無效的會員資訊";
          return;
        }

        try {
          const res = await fetch(`/api/activities/my?member_id=${memberId}`);
          let data = await res.json();

          const container = document.getElementById("my-activities");
          container.innerHTML = "";

          const cardContainer = document.createElement("div");
          cardContainer.className = "activity-card-container";

          // 新增按鈕卡片
          const addActivityCard = document.createElement("div");
          addActivityCard.className = "activity-card add-activity-card";
          addActivityCard.onclick = openActivityTypeModal;
          addActivityCard.innerHTML = '<span class="plus-sign">＋</span>';


          cardContainer.appendChild(addActivityCard);

          if (data.length === 0) {
            container.innerText = "尚未發起任何活動";
            container.appendChild(cardContainer); // 確保按鈕卡片仍然顯示
            return;
          }

          // 按開始時間排序，新的在前，舊的在後
          data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

          data.forEach((activity) => {
            const card = document.createElement("div");
            card.className = "activity-card";

            // ✅ 只有「訓練課程」且 organizer_has_discount = true 才顯示折角
            const isTraining = (activity.type === 'class' || activity.type === 'muti_class');
            const discountCorner = (isTraining && activity.organizer_participated)
              ? `
                <span class="discount-corner">
                  <svg class="discount-corner__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" aria-hidden="true">
                    <path d="M208.49,64.47l-144,144a12,12,0,1,1-17-17l144-144a12,12,0,0,1,17,17ZM47.72,104.27A40,40,0,1,1,76,116,39.72,39.72,0,0,1,47.72,104.27ZM60,76a16,16,0,1,0,4.69-11.31A15.87,15.87,0,0,0,60,76ZM220,180a40,40,0,1,1-11.72-28.29A39.71,39.71,0,0,1,220,180Zm-24,0a15.87,15.87,0,0,0-4.69-11.32h0A16,16,0,1,0,196,180Z" fill="white"/>
                  </svg>
                </span>`
              : "";


            const now = new Date();
            const signupDeadline = new Date(activity.registration_deadline);
            const startTime = new Date(activity.start_time);
            const endTime = new Date(activity.end_time);

            let statusText = "審核階段"; // 預設
            if (now < signupDeadline) {
              statusText = "審核階段";
            } else if (now >= signupDeadline && now < startTime) {
              statusText = "準備中";
            } else if (now >= startTime && now <= endTime) {
              statusText = "進行中";
            } else if (now > endTime) {
              statusText = "已結束";
            }

            card.innerHTML = `
                ${discountCorner}  <!-- 👈 折角放最前面 -->
                <div class="custom-card-header">
                  <h3 class="custom-card-title">${activity.title}</h3>
                  <span class="status-badge" style="background-color:#fda7a8;">
                    ${statusText}
                  </span>
                </div>

            


               <p class="custom-card-info">
                ${activity.sport_name} ｜ ${activity.level ? activity.level : '等級'} ｜ 由 ${activity.organizer.name || '未知'} 發起
              </p>



              <p class="custom-card-icon-line"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2c4975" viewBox="0 0 256 256"><path d="M128,64a40,40,0,1,0,40,40A40,40,0,0,0,128,64Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,128Zm0-112a88.1,88.1,0,0,0-88,88c0,31.4,14.51,64.68,42,96.25a254.19,254.19,0,0,0,41.45,38.3,8,8,0,0,0,9.18,0A254.19,254.19,0,0,0,174,200.25c27.45-31.57,42-64.85,42-96.25A88.1,88.1,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z"></path></svg> ${activity.location_name}</p>

              <p class="custom-card-icon-line">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2c4975" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm64-88a8,8,0,0,1-8,8H128a8,8,0,0,1-8-8V72a8,8,0,0,1,16,0v48h48A8,8,0,0,1,192,128Z"></path></svg>  ${
                activity.start_time && activity.end_time
                    ? (() => {
                        const s = new Date(activity.start_time);
                        const e = new Date(activity.end_time);
                        const md = `${s.getMonth()+1}/${s.getDate()}`;
                        const wk = `（${twWeekday(s)}）`;  // ← 只顯示「一～日」
                        const st = `${pad2(s.getHours())}:${pad2(s.getMinutes())}`;
                        const et = `${pad2(e.getHours())}:${pad2(e.getMinutes())}`;
                        return `${md} ${wk} ${st} - ${et}`;
                      })()
                    : '未設定'
                }
              </p>

              <p class="custom-card-icon-line">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2c4975" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-68a28,28,0,0,1-28,28h-4v8a8,8,0,0,1-16,0v-8H104a8,8,0,0,1,0-16h36a12,12,0,0,0,0-24H116a28,28,0,0,1,0-56h4V72a8,8,0,0,1,16,0v8h16a8,8,0,0,1,0,16H116a12,12,0,0,0,0,24h24A28,28,0,0,1,168,148Z"></path></svg> ${activity.venue_fee === 0 ? '免費' : activity.venue_fee} ｜   <span class="custom-card-tag ${
    (activity.type === 'class' || activity.type === 'muti_class') ? 'training' : 'general'
  }">${
                    activity.type === 'class'
                      ? '訓練課程｜單堂'
                      : (activity.type === 'muti_class'
                          ? `訓練課程｜共 ${activity.count ?? '?'} 堂`
                          : '一般活動'
                        )
                  }
        </span>
              </p>

            `;
                    
           card.addEventListener("click", () => {
    window.location.href = `/api/activities/created_details_page?id=${activity.activity_id}${memberId ? `&member_id=${memberId}` : ''}`;
});
            cardContainer.appendChild(card);
          });

          container.appendChild(cardContainer);
        } catch (error) {
          document.getElementById("my-activities").innerText =
            "載入失敗，請稍後再試。";
          console.error(error);
        }
      }

      async function loadJoinedActivities() {
        if (!memberId) {
          document.getElementById("content-1").innerText = "無效的會員資訊";
          return;
        }

        try {
          const res = await fetch(
            `/api/activities/joined?member_id=${memberId}`
          );
          const data = await res.json();

          const container = document.getElementById("content-1");
          container.innerHTML = "";

          if (data.length === 0) {
            container.innerText = "尚未參加任何活動";
            return;
          }

          const cardContainer = document.createElement("div");
          cardContainer.className = "activity-card-container";

          data.forEach((activity) => {
            const card = document.createElement("div");
            card.className = "activity-card";
            const now = new Date();
            const signupDeadline = new Date(activity.registration_deadline);
            const startTime = new Date(activity.start_time);
            const endTime = new Date(activity.end_time);

            let statusText = "已報名"; // 預設 → 代表已審核通過
            if (now < signupDeadline) {
              statusText = "已報名";
            } else if (now >= signupDeadline && now < startTime) {
              statusText = "準備中";
            } else if (now >= startTime && now <= endTime) {
              statusText = "進行中";
            } else if (now > endTime) {
              statusText = "已結束";
            }
            card.innerHTML = `
        <div class="custom-card-header">
            <h3 class="custom-card-title">${activity.title}</h3>
            <span class="status-badge">${statusText}</span>
          </div>
          <p class="custom-card-info">
            ${activity.sport_name} ｜ ${activity.level ? activity.level : '等級'} ｜ 由 ${activity.organizer.name || '未知'} 發起
          </p>

          <p class="custom-card-icon-line"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2c4975" viewBox="0 0 256 256"><path d="M128,64a40,40,0,1,0,40,40A40,40,0,0,0,128,64Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,128Zm0-112a88.1,88.1,0,0,0-88,88c0,31.4,14.51,64.68,42,96.25a254.19,254.19,0,0,0,41.45,38.3,8,8,0,0,0,9.18,0A254.19,254.19,0,0,0,174,200.25c27.45-31.57,42-64.85,42-96.25A88.1,88.1,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z"></path></svg> ${activity.location_name}</p>

          <p class="custom-card-icon-line">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2c4975" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm64-88a8,8,0,0,1-8,8H128a8,8,0,0,1-8-8V72a8,8,0,0,1,16,0v48h48A8,8,0,0,1,192,128Z"></path></svg> ${
            activity.start_time && activity.end_time
                ? (() => {
                    const s = new Date(activity.start_time);
                    const e = new Date(activity.end_time);
                    const md = `${s.getMonth()+1}/${s.getDate()}`;
                    const wk = `（${twWeekday(s)}）`;  // ← 只顯示「一～日」
                    const st = `${pad2(s.getHours())}:${pad2(s.getMinutes())}`;
                    const et = `${pad2(e.getHours())}:${pad2(e.getMinutes())}`;
                    return `${md} ${wk} ${st} - ${et}`;
                  })()
                : '未設定'
            }
          </p>

          <p class="custom-card-icon-line">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#2c4975" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-68a28,28,0,0,1-28,28h-4v8a8,8,0,0,1-16,0v-8H104a8,8,0,0,1,0-16h36a12,12,0,0,0,0-24H116a28,28,0,0,1,0-56h4V72a8,8,0,0,1,16,0v8h16a8,8,0,0,1,0,16H116a12,12,0,0,0,0,24h24A28,28,0,0,1,168,148Z"></path></svg>
            ${(() => {
                  if (activity.venue_fee === 0) {
                    return `免費 ｜ <span class="custom-card-tag general">一般活動</span>`;
                  }
                  const isTraining = (activity.type === 'class' || activity.type === 'muti_class');
                if (isTraining && isPaidMember && activity.organizer_participated) {
                  const newPrice = Math.round(activity.venue_fee * 0.8); // 8折
                  return `
                    <span class="price-and-tag">
                      <span class="price-wrapper">
                        <span class="original-price">${activity.venue_fee} 元</span>
                        <span class="discount-price">${newPrice} 元</span>
                      </span>
                      <span style="margin: 0 -10px;">｜</span>
                      <span class="custom-card-tag training">
                        ${activity.type === 'class'
                          ? '訓練課程｜單堂'
                          : `訓練課程｜共 ${activity.count ?? '?'} 堂`}
                      </span>
                    </span>
                  `;
                } else if (isTraining) {
                  return `
                    ${activity.venue_fee} 元 ｜ 
                    <span class="custom-card-tag training">
                      ${activity.type === 'class'
                        ? '訓練課程｜單堂'
                        : `訓練課程｜共 ${activity.count ?? '?'} 堂`}
                    </span>
                  `;
                }

                  // 一般活動
                  return `
                    ${activity.venue_fee} 元 ｜ 
                    <span class="custom-card-tag general">一般活動</span>
                  `;
              })()}
            </p>


        `;
card.addEventListener("click", () => {
    window.location.href = `/api/activities/joined_details_page?id=${activity.activity_id}${memberId ? `&member_id=${memberId}` : ''}`;
});
            cardContainer.appendChild(card);
          });

          container.appendChild(cardContainer);
        } catch (error) {
          document.getElementById("content-1").innerText =
            "載入失敗，請稍後再試。";
          console.error(error);
        }
      }

      let currentActivityId = null;

      window.onload = function () {
        switchTab(0);
        loadMyActivities();
        loadJoinedActivities(); // 新增載入「我參加的活動」
      };
    </script>
    <script>
      document.querySelectorAll(".bottom-item").forEach((item) => {
      item.addEventListener("click", function (e) {
        e.preventDefault(); // ✅ 阻止立即跳頁

        // 移除舊 ripple（確保只有一個）
        const oldRipple = this.querySelector(".ripple");
        if (oldRipple) oldRipple.remove();

        // 建立新 ripple
        const ripple = document.createElement("span");
        ripple.classList.add("ripple");

        const rect = this.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        ripple.style.width = ripple.style.height = `${size * 2}px`;
        ripple.style.left = `${e.clientX - rect.left - size}px`;
        ripple.style.top = `${e.clientY - rect.top - size}px`;

        this.appendChild(ripple);

        // 切換 active 樣式
        document.querySelectorAll(".bottom-item").forEach((i) =>
          i.classList.remove("active")
        );
        this.classList.add("active");

        // ✅ 延遲導頁：依照順序呼叫對應函式
        const index = [...document.querySelectorAll(".bottom-item")].indexOf(this);
        setTimeout(() => {
          if (index === 0) goToPage();        // 地圖
          else if (index === 1) goToActivity(); // 活動
          else if (index === 2) goToNews();     // 通知，暫時不導頁
          else if (index === 3) goToProfile(); // 個人
        }, 300);
      });
    });
      function openActivityTypeModal() {
      console.log("彈窗觸發了");
      document.getElementById("activityTypeModal").classList.add("show");
    }

    function closeActivityTypeModal() {
      document.getElementById("activityTypeModal").classList.remove("show");
    }

    function goToCreateWithType(type) {
      if (!memberId) {
        alert("無效的會員資訊！");
        return;
      }

      if (type === 'general') {
        window.location.href = `/create_activity?member_id=${memberId}`;
      } else if (type === 'course') {
        window.location.href = `/create_class?member_id=${memberId}`;
      }
    }



    // 點擊彈窗外部區域時關閉彈窗
    document.getElementById("activityTypeModal").addEventListener("click", function (event) {
    const box = this.querySelector(".activity-type-box");
    if (!box.contains(event.target)) {
      this.classList.remove("show");
    }
  });


  // 🔧 改為動態從 API 取得會員訂閱狀態

    if (memberId) {
      fetch(`/api/members/${memberId}`)
        .then(res => res.json())
        .then(data => {
          if (data.is_subscribed !== undefined) {
            isPaidMember = data.is_subscribed;
          }
          updateMemberUI();
        })
        .catch(() => {
          isPaidMember = false;
          updateMemberUI();
        });
    } else {
      updateMemberUI();
    }

    function updateMemberUI() {
      // 依 isPaidMember 控制 UI
      const courseBtn = document.querySelector('.activity-type-btn[data-type="course"]');
      if (courseBtn){
        if (!isPaidMember){
          courseBtn.classList.add('is-locked');
          if (!courseBtn.querySelector('.lock-pill')) {
            courseBtn.insertAdjacentHTML('afterbegin','<span class="lock-pill">付費會員限定</span>');
          }
          const intercept = (e) => { e.preventDefault(); e.stopPropagation(); openUpgrade(); };
          courseBtn.addEventListener('click', intercept, true);
          courseBtn.setAttribute('aria-disabled','true');
          courseBtn.setAttribute('title','付費會員限定');
        } else {
          courseBtn.classList.remove('is-locked');
          const pill = courseBtn.querySelector('.lock-pill'); if (pill) pill.remove();
          const clone = courseBtn.cloneNode(true);
          courseBtn.parentNode.replaceChild(clone, courseBtn);
        }
      }
    }

    // --- 問號說明 ---
    function openTypeInfo(){ document.getElementById('typeInfoModal').style.display='flex'; }
    function closeTypeInfo(){ document.getElementById('typeInfoModal').style.display='none'; }

    // --- 升級提示 ---
    function openUpgrade(){
      // 不關掉選擇活動類型彈窗，直接把升級提示顯示在上層
      document.getElementById('upgradeModal').style.display = 'flex';
    }
    function closeUpgrade(){ document.getElementById('upgradeModal').style.display='none'; }
    function goToMembership(){
      window.location.href = `/payment?member_id=${memberId}`;
      
    }

    document.addEventListener('DOMContentLoaded', () => {
      // 問號：開說明
      const infoBtn = document.getElementById('typeInfoBtn');
      if (infoBtn){
        infoBtn.addEventListener('click', openTypeInfo);
        infoBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') openTypeInfo(); });
      }

      // 訓練課程：依會員狀態控制（取代原本那段）
      const courseBtn = document.querySelector('.activity-type-btn[data-type="course"]');
      if (courseBtn){
        if (!isPaidMember){
          // 外觀鎖定（需要你有加第1步的 .is-locked CSS）
          courseBtn.classList.add('is-locked');

          // 動態加膠囊（避免重複）
          if (!courseBtn.querySelector('.lock-pill')) {
            courseBtn.insertAdjacentHTML('afterbegin','<span class="lock-pill">付費會員限定</span>');
          }

          // 攔截點擊，改為開升級視窗（用捕獲階段擋住 inline onclick）
          const intercept = (e) => { e.preventDefault(); e.stopPropagation(); openUpgrade(); };
          courseBtn.addEventListener('click', intercept, true);

          courseBtn.setAttribute('aria-disabled','true');
          courseBtn.setAttribute('title','付費會員限定');
        } else {
          // 已開通：解除鎖定
          courseBtn.classList.remove('is-locked');
          const pill = courseBtn.querySelector('.lock-pill'); if (pill) pill.remove();

          // 移除任何捕獲監聽，保留原本 onclick="goToCreateWithType('course')"
          const clone = courseBtn.cloneNode(true);
          courseBtn.parentNode.replaceChild(clone, courseBtn);
        }
      }
    });
    // 點彈窗外關閉（沿用你的寫法，額外加在兩個新 modal 上）
    ['typeInfoModal','upgradeModal'].forEach(id=>{
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('click', function(e){
        const content = this.querySelector('.modal-content');
        if (content && !content.contains(e.target)) this.style.display = 'none';
      });
    });
    </script>    
  </body>
</html>
